<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰ø∫„ÅÆÂ§ß‰ºö„Åæ„Åß„ÅÆÈÅì„ÅÆ„Çä</title>
    <meta name="description" content="2025Âπ¥10Êúà18Êó•„ÅÆÂ§ß‰ºö„Å´Âêë„Åë„Åü‰ΩìÈáçÁÆ°ÁêÜ„Å®Á≠ãÂäõ„Éà„É¨„Éº„Éã„É≥„Ç∞Ë®òÈå≤„Ç∑„Çπ„ÉÜ„É†">
    
    <!-- OGPË®≠ÂÆö -->
    <meta property="og:title" content="‰ø∫„ÅÆÂ§ß‰ºö„Åæ„Åß„ÅÆÈÅì„ÅÆ„Çä">
    <meta property="og:description" content="Â§ß‰ºö„Å´Âêë„Åë„Åü‰ΩìÈáçÁÆ°ÁêÜ„Å®Á≠ãÂäõ„Éà„É¨„Éº„Éã„É≥„Ç∞Ë®òÈå≤„Ç∑„Çπ„ÉÜ„É†">
    <meta property="og:image" content="https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&h=630&q=80">
    <meta property="og:url" content="">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="‰ø∫„ÅÆÂ§ß‰ºö„Åæ„Åß„ÅÆÈÅì„ÅÆ„Çä">
    
    <!-- Twitter CardË®≠ÂÆö -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="‰ø∫„ÅÆÂ§ß‰ºö„Åæ„Åß„ÅÆÈÅì„ÅÆ„Çä">
    <meta name="twitter:description" content="Â§ß‰ºö„Å´Âêë„Åë„Åü‰ΩìÈáçÁÆ°ÁêÜ„Å®Á≠ãÂäõ„Éà„É¨„Éº„Éã„É≥„Ç∞Ë®òÈå≤„Ç∑„Çπ„ÉÜ„É†">
    <meta name="twitter:image" content="https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&h=630&q=80">
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üí™</text></svg>">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .tab {
            flex: 1;
            padding: 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            color: #64748b;
            transition: all 0.3s ease;
            position: relative;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tab.active {
            color: #4f46e5;
            background: white;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #4f46e5, #7c3aed);
        }

        .tab:hover:not(.active) {
            background: #f1f5f9;
            color: #475569;
        }

        .tab .desktop-text {
            display: inline;
        }

        .tab .mobile-text {
            display: none;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }

        .form-section h3 {
            color: #1e293b;
            margin-bottom: 20px;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select {
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            min-height: 48px;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4f46e5;
        }

        /* Êï∞ÂÄ§ÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ„ÅÆÊúÄÈÅ©Âåñ */
        .form-group input[type="number"] {
            appearance: textfield;
            -moz-appearance: textfield;
        }
        
        .form-group input[type="number"]::-webkit-outer-spin-button,
        .form-group input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .btn {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            min-height: 48px;
            min-width: 100px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(79, 70, 229, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
        }

        .btn-secondary:hover {
            box-shadow: 0 10px 20px rgba(107, 114, 128, 0.3);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.85rem;
            min-height: 36px;
            min-width: 70px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .data-table th,
        .data-table td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.9rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .data-table th {
            background: #f8fafc;
            font-weight: 600;
            color: #374151;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .data-table tr:hover {
            background: #f9fafb;
        }

        .weight-increase {
            color: #dc2626;
            font-weight: 600;
        }

        .weight-decrease {
            color: #2563eb;
            font-weight: 600;
        }

        .saturday {
            color: #0095d9;
            font-weight: 600;
        }

        .sunday-holiday {
            color: #d9333f;
            font-weight: 600;
        }

        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
            overflow: hidden;
        }

        .chart-container h3 {
            color: #1e293b;
            margin-bottom: 20px;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .chart-wrapper {
            position: relative;
            height: 450px;
            width: 100%;
            padding: 10px;
        }

        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .status-success {
            background: #dcfce7;
            color: #16a34a;
            border: 1px solid #bbf7d0;
        }

        .status-error {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }

        .goal-section {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .goal-input-form {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .goal-input-form input {
            width: 100px;
            padding: 10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            color: #1f2937;
            font-size: 1rem;
            font-weight: 600;
        }

        .goal-display {
            display: none;
        }

        .goal-display.active {
            display: block;
        }

        .goal-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .goal-stat {
            text-align: center;
        }

        .goal-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .goal-stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .progress-container {
            margin: 20px 0;
        }

        .progress-item {
            margin-bottom: 15px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 6px;
            transition: width 0.3s ease;
        }

        .progress-days {
            background: linear-gradient(90deg, #3b82f6, #1d4ed8);
        }

        .progress-weight {
            background: linear-gradient(90deg, #f59e0b, #d97706);
        }

        .progress-weight.completed {
            background: linear-gradient(90deg, #ef4444, #dc2626);
        }

        .clear-achievement {
            text-align: center;
            font-size: 2rem;
            font-weight: 900;
            color: #fbbf24;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .btn-goal {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.5);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-goal:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.8);
            transform: translateY(-1px);
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .mobile-header {
            display: none;
        }

        .desktop-header {
            display: table-row;
        }

        .export-section {
            background: #f8fafc;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }


        /* ‰∫àÊ∏¨Ë©≥Á¥∞„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆ„Çπ„Çø„Ç§„É´ */
        .prediction-details {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            border-radius: 15px;
            margin: 15px 0;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .prediction-header {
            padding: 15px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s ease;
        }

        .prediction-header:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .prediction-header h4 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
        }

        #prediction-toggle {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .prediction-content {
            padding: 0 20px 20px 20px;
            display: none;
        }

        .prediction-content.active {
            display: block;
        }

        .prediction-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .prediction-item {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: transform 0.2s ease;
        }

        .prediction-item:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.2);
        }

        .prediction-icon {
            font-size: 1.5rem;
            width: 40px;
            text-align: center;
        }

        .prediction-text {
            flex: 1;
        }

        .prediction-label {
            font-size: 0.85rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .prediction-value {
            font-size: 1rem;
            font-weight: 700;
        }

        .confidence-high {
            color: #10b981;
        }

        .confidence-low {
            color: #f59e0b;
        }

        .plateau-detected {
            color: #ef4444;
        }

        .plateau-normal {
            color: #10b981;
        }

        /* „É¢„Éê„Ç§„É´ÂØæÂøú */
        @media (max-width: 768px) {
            .prediction-details {
                margin: 10px 0;
                border-radius: 10px;
            }

            .prediction-header {
                padding: 12px 15px;
            }

            .prediction-header h4 {
                font-size: 1rem;
            }

            .prediction-content {
                padding: 0 15px 15px 15px;
            }

            .prediction-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .prediction-item {
                padding: 12px;
                gap: 10px;
            }

            .prediction-icon {
                font-size: 1.3rem;
                width: 35px;
            }

            .prediction-label {
                font-size: 0.8rem;
            }

            .prediction-value {
                font-size: 0.9rem;
            }
        }
        /* „Çπ„Éû„Éº„Éà„Éï„Ç©„É≥ÊúÄÈÅ©Âåñ */
        @media (max-width: 768px) {
            .goal-section {
                padding: 15px;
                margin-bottom: 20px;
            }

            .goal-input-form {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }

            .goal-input-form input {
                width: 100%;
                max-width: 200px;
                margin: 0 auto;
            }

            .goal-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .goal-stat-value {
                font-size: 1.2rem;
            }

            .goal-stat-label {
                font-size: 0.8rem;
            }

            .clear-achievement {
                font-size: 1.5rem;
            }
        }
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }

            .container {
                margin: 0;
                border-radius: 10px;
            }

            .header {
                padding: 15px;
            }

            .header h1 {
                font-size: 1.8rem;
            }

            .tabs {
                flex-direction: row;
            }

            .tab {
                padding: 10px 5px;
                font-size: 1.2rem;
                min-height: 50px;
            }

            .tab .desktop-text {
                display: none;
            }

            .tab .mobile-text {
                display: inline;
                font-size: 1.5rem;
            }

            .tab-content {
                padding: 15px;
            }

            .form-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .form-section {
                padding: 15px;
                margin-bottom: 15px;
            }

            .form-section h3 {
                font-size: 1.1rem;
                margin-bottom: 15px;
            }

            .form-group label {
                font-size: 0.9rem;
                margin-bottom: 6px;
            }

            .form-group input,
            .form-group select {
                padding: 10px;
                font-size: 16px; /* iOS zoom prevention */
                min-height: 44px;
            }

            /* ÁâπÂÆö„ÅÆÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ„ÅÆÂπÖÂà∂Èôê */
            .form-group input[type="number"] {
                max-width: 150px;
            }

            .form-group input[type="date"] {
                max-width: 200px;
            }

            .form-group select {
                max-width: 200px;
            }

            .button-group {
                flex-direction: column;
                gap: 8px;
            }

            .btn {
                padding: 12px 20px;
                font-size: 0.95rem;
                margin-right: 0;
                width: 100%;
                min-height: 48px;
            }

            .btn-small {
                padding: 8px 12px;
                font-size: 0.8rem;
                min-height: 40px;
                width: auto;
                margin: 2px;
            }

            .table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                margin: 0 -15px;
                border-radius: 0;
            }

            .data-table {
                min-width: 900px;
                font-size: 0.8rem;
                border-radius: 0;
            }

            .data-table th,
            .data-table td {
                padding: 8px 6px;
                min-width: 80px;
                font-size: 0.75rem;
            }

            .data-table th:last-child,
            .data-table td:last-child {
                min-width: 140px;
            }

            .mobile-header {
                display: table-row;
            }

            .desktop-header {
                display: none;
            }

            .chart-container {
                padding: 15px;
                margin: 0 -15px 15px -15px;
                border-radius: 0;
            }

            .chart-container h3 {
                font-size: 1rem;
                margin-bottom: 15px;
                line-height: 1.3;
            }

            .chart-wrapper {
                height: 500px;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                padding: 5px;
            }

            .export-section {
                padding: 15px;
                margin-top: 15px;
            }

            .export-section h3 {
                font-size: 1.1rem;
                margin-bottom: 10px;
            }

            .export-section p {
                font-size: 0.9rem;
                line-height: 1.4;
            }

            /* „Çπ„ÇØ„É≠„Éº„É´„Éê„Éº„ÅÆÊîπÂñÑ */
            .table-container::-webkit-scrollbar,
            .chart-wrapper::-webkit-scrollbar {
                height: 8px;
                background: #f1f5f9;
            }

            .table-container::-webkit-scrollbar-thumb,
            .chart-wrapper::-webkit-scrollbar-thumb {
                background: #3b82f6;
                border-radius: 4px;
                border: 1px solid #f1f5f9;
            }
        }

        /* Ê•µÂ∞èÁîªÈù¢Ôºà320px‰ª•‰∏ãÔºâ„ÅÆËøΩÂä†ÂØæÂøú */
        @media (max-width: 320px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .tab {
                padding: 8px 3px;
                font-size: 1rem;
            }

            .tab .mobile-text {
                font-size: 1.3rem;
            }

            .form-section {
                padding: 12px;
            }

            .chart-wrapper {
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí™ ‰ø∫„ÅÆÂ§ß‰ºö„Åæ„Åß„ÅÆÈÅì„ÅÆ„Çä</h1>
            <p>Ver1.37 [Áµ±Ë®àÂ≠¶ÁöÑ‰ΩìÈáç‰∫àÊ∏¨„ÉªÁ≠ã„Éà„É¨ÂäπÊûúÂàÜÊûê]</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('daily')">
                <span class="desktop-text">Êó•Ê¨°„Éá„Éº„ÇøÁÆ°ÁêÜ</span>
                <span class="mobile-text">‚öñÔ∏è</span>
            </button>
            <button class="tab" onclick="showTab('training')">
                <span class="desktop-text">Á≠ãÂäõ„Éà„É¨„Éº„Éã„É≥„Ç∞ÁÆ°ÁêÜ</span>
                <span class="mobile-text">üèãÔ∏è</span>
            </button>
            <button class="tab" onclick="showTab('analysis')">
                <span class="desktop-text">„Éá„Éº„ÇøÂàÜÊûê„Éª„Ç∞„É©„Éï</span>
                <span class="mobile-text">üìà</span>
            </button>
            <button class="tab" onclick="showTab('export')">
                <span class="desktop-text">„Éá„Éº„Çø„Ç®„ÇØ„Çπ„Éù„Éº„Éà</span>
                <span class="mobile-text">üì§</span>
            </button>
        </div>

        <div id="status-message"></div>

        <!-- Êó•Ê¨°„Éá„Éº„ÇøÁÆ°ÁêÜ„Çø„Éñ -->
        <div id="daily" class="tab-content active">
            <!-- ÁõÆÊ®ôË®≠ÂÆö„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div class="goal-section" id="goal-section">
                <div id="goal-input" class="goal-input-form">
                    <h3>üéØ ÁõÆÊ®ô‰ΩìÈáç„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ</h3>
                    <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap; justify-content: center;">
                        <input type="number" id="target-weight" min="40" max="100" step="0.1" placeholder="65.0">
                        <span style="font-weight: 600;">kg</span>
                        <button type="button" class="btn-goal" onclick="setGoal()">Ë®≠ÂÆö„Åô„Çã</button>
                    </div>
                </div>
                
                <div id="goal-display" class="goal-display">
                    <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 15px;">
                        <h3 id="goal-title">üéØ ÁõÆÊ®ô: --kg</h3>
                        <button type="button" class="btn-goal" onclick="resetGoal()" style="margin-left: auto;">ÂÜçË®≠ÂÆö</button>
                    </div>
                    
                    <div class="goal-stats">
                        <div class="goal-stat">
                            <div class="goal-stat-value" id="remaining-days">--</div>
                            <div class="goal-stat-label">ÊÆã„ÇäÊó•Êï∞</div>
                        </div>
                        <div class="goal-stat">
                            <div class="goal-stat-value" id="remaining-weight">--</div>
                            <div class="goal-stat-label">ÊÆã„ÇäÊ∏õÈáè</div>
                        </div>
                        <div class="goal-stat">
                            <div class="goal-stat-value" id="current-weight-display">--</div>
                            <div class="goal-stat-label">ÁèæÂú®‰ΩìÈáç</div>
                        </div>
                        <div class="goal-stat">
                            <div class="goal-stat-value" id="daily-target">--</div>
                            <div class="goal-stat-label">1Êó•ÁõÆÊ®ô</div>
                        </div>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-item">
                            <div class="progress-label">
                                <span>üìÖ Êó•Êï∞ÈÄ≤Êçó</span>
                                <span id="days-progress-text">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill progress-days" id="days-progress-bar" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <div class="progress-item">
                            <div class="progress-label">
                                <span id="weight-progress-label">‚öñÔ∏è Ê∏õÈáèÈÄ≤Êçó</span>
                                <span id="weight-progress-text">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill progress-weight" id="weight-progress-bar" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <div id="clear-achievement" class="clear-achievement" style="display: none;">
                            üéâ ClearÔºÅ üéâ
                        </div>

                        <!-- ‰∫àÊ∏¨Ë©≥Á¥∞„Çª„ÇØ„Ç∑„Éß„É≥ -->
                        <div id="prediction-details" class="prediction-details" style="display: none;">
                            <div class="prediction-header" onclick="togglePredictionDetails()">
                                <h4>üìä ‰∫àÊ∏¨Ë©≥Á¥∞ <span id="prediction-toggle">‚ñº</span></h4>
                            </div>
                            <div id="prediction-content" class="prediction-content">
                                <div class="prediction-grid">
                                    <div class="prediction-item">
                                        <div class="prediction-icon">üéØ</div>
                                        <div class="prediction-text">
                                            <div class="prediction-label">Á≤æÂØÜ‰ΩìÈáç‰∫àÊ∏¨</div>
                                            <div class="prediction-value" id="advanced-prediction">--kg</div>
                                        </div>
                                    </div>
                                    <div class="prediction-item">
                                        <div class="prediction-icon">‚ö†Ô∏è</div>
                                        <div class="prediction-text">
                                            <div class="prediction-label">„Éó„É©„Éà„ÉºÊ§úÂá∫</div>
                                            <div class="prediction-value" id="plateau-status">--</div>
                                        </div>
                                    </div>
                                    <div class="prediction-item">
                                        <div class="prediction-icon">üìä</div>
                                        <div class="prediction-text">
                                            <div class="prediction-label">„Éá„Éº„ÇøÂìÅË≥™</div>
                                            <div class="prediction-value" id="data-quality">--</div>
                                        </div>
                                    </div>
                                    <div class="prediction-item">
                                        <div class="prediction-icon">üèãÔ∏è</div>
                                        <div class="prediction-text">
                                            <div class="prediction-label">Á≠ã„Éà„É¨ÂäπÊûú</div>
                                            <div class="prediction-value" id="training-effect">--</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>üìä Êó•Ê¨°„Éá„Éº„ÇøÂÖ•Âäõ</h3>
                <form id="daily-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="daily-date">Âπ¥ÊúàÊó•</label>
                            <input type="date" id="daily-date" required>
                        </div>
                        <div class="form-group">
                            <label for="weight">‰ΩìÈáç (kg)</label>
                            <input type="number" id="weight" step="0.1" min="40" max="150" required placeholder="‰æã: 70.5">
                        </div>
                        <div class="form-group">
                            <label for="calories">ÊëÇÂèñ„Ç´„É≠„É™„Éº (kcal)</label>
                            <input type="number" id="calories" min="800" max="5000" required placeholder="‰æã: 2000">
                        </div>
                        <div class="form-group">
                            <label for="steps">Ê≠©Êï∞</label>
                            <input type="number" id="steps" min="0" max="50000" required placeholder="‰æã: 8000">
                        </div>
                        <div class="form-group">
                            <label for="event">„Ç§„Éô„É≥„Éà</label>
                            <input type="text" id="event" maxlength="50" placeholder="‰æã: ‰ºöÈ£ü„ÄÅ‰ΩìË™ø‰∏çËâØ„ÄÅ„ÉÅ„Éº„Éà„Éá„Ç§">
                        </div>
                    </div>
                    <div class="button-group">
                        <button type="submit" class="btn">„Éá„Éº„Çø‰øùÂ≠ò</button>
                        <button type="button" class="btn btn-secondary" onclick="clearDailyForm()">„ÇØ„É™„Ç¢</button>
                    </div>
                </form>
            </div>

            <div class="form-section">
                <h3>üìà Êó•Ê¨°„Éá„Éº„Çø‰∏ÄË¶ß</h3>
                <div class="table-container">
                    <table class="data-table" id="daily-table">
                        <thead>
                            <tr class="desktop-header">
                                <th>Êó•‰ªò</th>
                                <th>‰ΩìÈáç (kg)</th>
                                <th>ÂâçÊó•ÊØî</th>
                                <th>ÊëÇÂèñ„Ç´„É≠„É™„Éº (kcal)</th>
                                <th>Ê≠©Êï∞</th>
                                <th>Ê≠©Ë°åÊ∂àË≤ª„Ç´„É≠„É™„Éº</th>
                                <th>Á≠ã„Éà„É¨Ê∂àË≤ª„Ç´„É≠„É™„Éº</th>
                                <th>„Ç§„Éô„É≥„Éà</th>
                                <th>Êìç‰Ωú</th>
                            </tr>
                            <tr class="mobile-header">
                                <th>üìÖ</th>
                                <th>‚öñÔ∏è</th>
                                <th>üßÆ</th>
                                <th>üçö</th>
                                <th>üö∂</th>
                                <th>üö∂</th>
                                <th>üèãÔ∏è</th>
                                <th>üìù</th>
                                <th>‚ùå</th>
                            </tr>
                        </thead>
                        <tbody id="daily-table-body">
                            <!-- „Éá„Éº„Çø„ÅåÂãïÁöÑ„Å´ÊåøÂÖ•„Åï„Çå„Åæ„Åô -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Á≠ãÂäõ„Éà„É¨„Éº„Éã„É≥„Ç∞ÁÆ°ÁêÜ„Çø„Éñ -->
        <div id="training" class="tab-content">
            <div class="form-section">
                <h3>üèãÔ∏è Á≠ãÂäõ„Éà„É¨„Éº„Éã„É≥„Ç∞Ë®òÈå≤</h3>
                <form id="training-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="training-date">Âπ¥ÊúàÊó•</label>
                            <input type="date" id="training-date" required>
                        </div>
                        <div class="form-group">
                            <label for="exercise">Á®ÆÁõÆ</label>
                            <select id="exercise" required>
                                <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                <option value="„Éô„É≥„ÉÅ„Éó„É¨„Çπ">„Éô„É≥„ÉÅ„Éó„É¨„Çπ</option>
                                <option value="„Éö„ÉÉ„ÇØ„Éï„É©„Ç§">„Éö„ÉÉ„ÇØ„Éï„É©„Ç§</option>
                                <option value="„Éá„Ç£„ÉÉ„Éó„Çπ">„Éá„Ç£„ÉÉ„Éó„Çπ</option>
                                <option value="„Éá„ÇØ„É©„Ç§„É≥„Éó„É¨„Çπ">„Éá„ÇØ„É©„Ç§„É≥„Éó„É¨„Çπ</option>
                                <option value="„É©„ÉÉ„Éà„Éó„É´„ÉÄ„Ç¶„É≥">„É©„ÉÉ„Éà„Éó„É´„ÉÄ„Ç¶„É≥</option>
                                <option value="DY„É≠„Éº„Ç§„É≥„Ç∞">DY„É≠„Éº„Ç§„É≥„Ç∞</option>
                                <option value="T„Éê„Éº„É≠„Éº„Ç§„É≥„Ç∞">T„Éê„Éº„É≠„Éº„Ç§„É≥„Ç∞</option>
                                <option value="„ÉÅ„É≥„Éã„É≥„Ç∞">„ÉÅ„É≥„Éã„É≥„Ç∞</option>
                                <option value="„Éû„Ç∑„É≥„Ç∑„Éß„É´„ÉÄ„Éº„Éó„É¨„Çπ">„Éû„Ç∑„É≥„Ç∑„Éß„É´„ÉÄ„Éº„Éó„É¨„Çπ</option>
                                <option value="„ÉÄ„É≥„Éô„É´„Çµ„Ç§„Éâ„É¨„Ç§„Ç∫">„ÉÄ„É≥„Éô„É´„Çµ„Ç§„Éâ„É¨„Ç§„Ç∫</option>
                                <option value="„ÉÄ„É≥„Éô„É´„É™„Ç¢„É¨„Ç§„Ç∫">„ÉÄ„É≥„Éô„É´„É™„Ç¢„É¨„Ç§„Ç∫</option>
                                <option value="„Ç§„É≥„ÇØ„É©„Ç§„É≥„ÉÄ„É≥„Éô„É´„Ç´„Éº„É´">„Ç§„É≥„ÇØ„É©„Ç§„É≥„ÉÄ„É≥„Éô„É´„Ç´„Éº„É´</option>
                                <option value="„Éá„ÉÉ„Éâ„É™„Éï„Éà">„Éá„ÉÉ„Éâ„É™„Éï„Éà</option>
                                <option value="„Çπ„ÇØ„ÉØ„ÉÉ„Éà">„Çπ„ÇØ„ÉØ„ÉÉ„Éà</option>
                                <option value="„Éè„ÉÉ„ÇØ„Çπ„ÇØ„ÉØ„ÉÉ„Éà">„Éè„ÉÉ„ÇØ„Çπ„ÇØ„ÉØ„ÉÉ„Éà</option>
                                <option value="45Â∫¶„É¨„ÉÉ„Ç∞„Éó„É¨„Çπ">45Â∫¶„É¨„ÉÉ„Ç∞„Éó„É¨„Çπ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="training-weight">ÈáçÈáè (kg)</label>
                            <input type="number" id="training-weight" step="0.5" min="1" max="300" required placeholder="‰æã: 80.0">
                        </div>
                        <div class="form-group">
                            <label for="reps">ÂõûÊï∞</label>
                            <select id="reps" required>
                                <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                                <option value="13">13</option>
                                <option value="14">14</option>
                                <option value="15">15</option>
                                <option value="16">16</option>
                                <option value="17">17</option>
                                <option value="18">18</option>
                                <option value="19">19</option>
                                <option value="20">20</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="sets">„Çª„ÉÉ„ÉàÊï∞</label>
                            <select id="sets" required>
                                <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                                <option value="13">13</option>
                                <option value="14">14</option>
                                <option value="15">15</option>
                                <option value="16">16</option>
                                <option value="17">17</option>
                                <option value="18">18</option>
                                <option value="19">19</option>
                                <option value="20">20</option>
                            </select>
                        </div>
                    </div>
                    <div class="button-group">
                        <button type="submit" class="btn">„Éà„É¨„Éº„Éã„É≥„Ç∞Ë®òÈå≤‰øùÂ≠ò</button>
                        <button type="button" class="btn btn-secondary" onclick="clearTrainingForm()">„ÇØ„É™„Ç¢</button>
                        <!-- ADD HERE: „Éà„É¨„Éº„Éã„É≥„Ç∞„Éó„É™„Çª„ÉÉ„Éà„Éú„Çø„É≥ -->
<button type="button" class="btn btn-secondary" onclick="loadYesterdayTraining()">Êò®Êó•„Å®Âêå„ÅòÂÜÖÂÆπ„ÇíÂÖ•Âäõ</button>
                    </div>
                </form>
            </div>

            <div class="form-section">
                <h3>üìã „Éà„É¨„Éº„Éã„É≥„Ç∞Ë®òÈå≤‰∏ÄË¶ß</h3>
                <div class="table-container">
                    <table class="data-table" id="training-table">
                        <thead>
                            <tr class="desktop-header">
                                <th>Êó•‰ªò</th>
                                <th>Á®ÆÁõÆ</th>
                                <th>ÈáçÈáè (kg)</th>
                                <th>ÂõûÊï∞</th>
                                <th>„Çª„ÉÉ„ÉàÊï∞</th>
                                <th>ÈÉ®‰Ωç</th>
                                <th>Âº∑Â∫¶</th>
                                <th>Êìç‰Ωú</th>
                            </tr>
                            <tr class="mobile-header">
                                <th>üìÖ</th>
                                <th>üèãÔ∏è</th>
                                <th>‚öñÔ∏è</th>
                                <th>üî¢</th>
                                <th>üî¢</th>
                                <th>üí™</th>
                                <th>üî•</th>
                                <th>‚ùå</th>
                            </tr>
                        </thead>
                        <tbody id="training-table-body">
                            <!-- „Éá„Éº„Çø„ÅåÂãïÁöÑ„Å´ÊåøÂÖ•„Åï„Çå„Åæ„Åô -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- „Éá„Éº„ÇøÂàÜÊûê„Éª„Ç∞„É©„Éï„Çø„Éñ -->
        <div id="analysis" class="tab-content">
            <div class="chart-container">
                <h3 id="chart-title">Â§ß‰ºöÂΩìÊó•„ÅØË®àÁÆó‰∏≠...„ÅßÁùÄÂú∞Ë¶ãËæº„ÅøÔºÅ</h3>
                <div class="chart-wrapper">
                    <canvas id="analysisChart"></canvas>
                </div>
            </div>
        </div>

        <!-- „Éá„Éº„Çø„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Çø„Éñ -->
        <div id="export" class="tab-content">
            <div class="export-section">
                <h3>üì§ „Éá„Éº„Çø„Ç®„ÇØ„Çπ„Éù„Éº„Éà</h3>
                <p>„Éá„Éº„Çø„ÇíCSVÂΩ¢Âºè„Åß„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åó„Å¶„ÄÅExcel„ÅßÈñã„Åè„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ</p>
                <div class="button-group">
                    <button class="btn" onclick="exportDailyData()">Êó•Ê¨°„Éá„Éº„Çø„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà</button>
                    <button class="btn" onclick="exportTrainingData()">„Éà„É¨„Éº„Éã„É≥„Ç∞„Éá„Éº„Çø„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà</button>
                    <button class="btn" onclick="exportAllData()">ÂÖ®„Éá„Éº„Çø„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API „Ç®„É≥„Éâ„Éù„Ç§„É≥„ÉàÔºà„Éá„É¢Áî®„Å™„ÅÆ„Åß„ÉÄ„Éü„ÉºÈñ¢Êï∞„Åß‰ª£ÊõøÔºâ
        const API_BASE = '/.netlify/functions';

        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let dailyData = [];
        let trainingData = [];
        let analysisChart = null;
        let targetGoal = null;
        
        // „É¶„Éº„Ç∂„ÉºÂü∫Êú¨ÊÉÖÂ†±ÔºàÂõ∫ÂÆöÂÄ§Ôºâ
        const USER_PROFILE = {
            age: 38,
            height: 176, // cm
            gender: 'male'
        };

        // Êó•Êú¨„ÅÆÁ•ùÊó•„Éá„Éº„Çø (2025Âπ¥)
        const holidays2025 = [
            '2025-01-01', '2025-01-13', '2025-02-11', '2025-02-23', '2025-03-20',
            '2025-04-29', '2025-05-03', '2025-05-04', '2025-05-05', '2025-07-21',
            '2025-08-11', '2025-09-15', '2025-09-23', '2025-10-13', '2025-11-03',
            '2025-11-23', '2025-12-23'
        ];

        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
            loadGoalData();
            setupDateDefaults();
            setupEventListeners();
            setupInputValidation();
        });

        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÅÆË®≠ÂÆö
        function setupEventListeners() {
            document.getElementById('daily-form').addEventListener('submit', handleDailySubmit);
            document.getElementById('training-form').addEventListener('submit', handleTrainingSubmit);
        }

        // ÂÖ•ÂäõÂÄ§Ê§úË®º„ÅÆË®≠ÂÆö
        function setupInputValidation() {
            // ‰ΩìÈáçÂÖ•Âäõ„ÅÆÊ§úË®º
            const weightInput = document.getElementById('weight');
            weightInput.addEventListener('blur', function() {
                const value = parseFloat(this.value);
                if (value && value < 40) this.value = 40;
                if (value && value > 150) this.value = 150;
            });

            // „Ç´„É≠„É™„ÉºÂÖ•Âäõ„ÅÆÊ§úË®º
            const caloriesInput = document.getElementById('calories');
            caloriesInput.addEventListener('blur', function() {
                const value = parseInt(this.value);
                if (value && value < 800) this.value = 800;
                if (value && value > 5000) this.value = 5000;
            });

            // Ê≠©Êï∞ÂÖ•Âäõ„ÅÆÊ§úË®º
            const stepsInput = document.getElementById('steps');
            stepsInput.addEventListener('blur', function() {
                const value = parseInt(this.value);
                if (value && value < 0) this.value = 0;
                if (value && value > 50000) this.value = 50000;
            });

            // „Éà„É¨„Éº„Éã„É≥„Ç∞ÈáçÈáè„ÅÆÊ§úË®º
            const trainingWeightInput = document.getElementById('training-weight');
            trainingWeightInput.addEventListener('blur', function() {
                const value = parseFloat(this.value);
                if (value && value < 1) this.value = 1;
                if (value && value > 300) this.value = 300;
            });
        }

        // „Éá„Éï„Ç©„É´„ÉàÊó•‰ªò„ÅÆË®≠ÂÆö
        function setupDateDefaults() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('daily-date').value = today;
            document.getElementById('training-date').value = today;
        }

        // „Çø„ÉñÂàá„ÇäÊõø„Åà
        function showTab(tabName) {
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));

            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'analysis') {
                setTimeout(() => drawAnalysisChart(), 100);
            }
        }

        // „Çπ„ÉÜ„Éº„Çø„Çπ„É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫
        function showStatus(message, type = 'success') {
            const statusEl = document.getElementById('status-message');
            statusEl.innerHTML = `<div class="status-message status-${type}">${message}</div>`;
            setTimeout(() => {
                statusEl.innerHTML = '';
            }, 3000);
        }

        // „Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÔºàÂÖÉ„ÅÆAPIÊé•Á∂ö„Å´Âæ©ÂÖÉÔºâ
        async function loadAllData() {
            try {
                showStatus('„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø‰∏≠...', 'success');
                
                // Êó•Ê¨°„Éá„Éº„ÇøË™≠„ÅøËæº„Åø
                const dailyResponse = await fetch(`${API_BASE}/get-daily-data`);
                if (dailyResponse.ok) {
                    dailyData = await dailyResponse.json();
                }

                // „Éà„É¨„Éº„Éã„É≥„Ç∞„Éá„Éº„ÇøË™≠„ÅøËæº„Åø
                const trainingResponse = await fetch(`${API_BASE}/get-training-data`);
                if (trainingResponse.ok) {
                    trainingData = await trainingResponse.json();
                }

                updateDailyTable();
                updateTrainingTable();
                updateGoalProgress();
                showStatus('„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü');
            } catch (error) {
                console.error('„Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
                showStatus('„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
            }
        }

        // ÁõÆÊ®ô„Éá„Éº„ÇøË™≠„ÅøËæº„Åø
        async function loadGoalData() {
            try {
                const response = await fetch(`${API_BASE}/get-goal-data`);
                if (response.ok) {
                    targetGoal = await response.json();
                    if (targetGoal) {
                        showGoalDisplay();
                        updateGoalProgress();
                    }
                }
            } catch (error) {
                console.error('ÁõÆÊ®ô„Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
            }
        }

        // ÁõÆÊ®ôË®≠ÂÆö
        async function setGoal() {
            const targetWeight = parseFloat(document.getElementById('target-weight').value);
            
            if (!targetWeight || targetWeight < 40 || targetWeight > 100) {
                showStatus('ÁõÆÊ®ô‰ΩìÈáç„ÅØ40kg„Äú100kg„ÅÆÁØÑÂõ≤„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }

            // ÁèæÂú®„ÅÆ‰ΩìÈáç„ÇíÂèñÂæóÔºàÊúÄÊñ∞„ÅÆË®òÈå≤Ôºâ
            let latestWeight = null;
            if (dailyData.length > 0) {
                const sortedData = [...dailyData].sort((a, b) => new Date(b.date) - new Date(a.date));
                latestWeight = sortedData[0].weight;
            }

            if (!latestWeight) {
                showStatus('„Åæ„Åö‰ΩìÈáç„Éá„Éº„Çø„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }

            const goalData = {
                targetWeight: targetWeight,
                setDate: new Date().toISOString().split('T')[0],
                startWeight: latestWeight
            };

            try {
                const response = await fetch(`${API_BASE}/save-goal-data`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(goalData)
                });

                if (response.ok) {
                    targetGoal = goalData;
                    showGoalDisplay();
                    updateGoalProgress();
                    showStatus('ÁõÆÊ®ô„ÇíË®≠ÂÆö„Åó„Åæ„Åó„ÅüÔºÅ');
                } else {
                    throw new Error('ÁõÆÊ®ôË®≠ÂÆö„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            } catch (error) {
                console.error('ÁõÆÊ®ôË®≠ÂÆö„Ç®„É©„Éº:', error);
                showStatus('ÁõÆÊ®ôË®≠ÂÆö„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
            }
        }

        // ÁõÆÊ®ôÂÜçË®≠ÂÆö
        async function resetGoal() {
            if (confirm('ÁõÆÊ®ô„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºü')) {
                try {
                    const response = await fetch(`${API_BASE}/delete-goal-data`, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    });

                    if (response.ok) {
                        document.getElementById('goal-input').style.display = 'block';
                        document.getElementById('goal-display').classList.remove('active');
                        document.getElementById('target-weight').value = '';
                        targetGoal = null;
                        showStatus('ÁõÆÊ®ô„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü');
                    } else {
                        throw new Error('ÁõÆÊ®ôÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                    }
                } catch (error) {
                    console.error('ÁõÆÊ®ôÂâäÈô§„Ç®„É©„Éº:', error);
                    showStatus('ÁõÆÊ®ôÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
                }
            }
        }

        // ÁõÆÊ®ôË°®Á§∫Âàá„ÇäÊõø„Åà
        function showGoalDisplay() {
            document.getElementById('goal-input').style.display = 'none';
            document.getElementById('goal-display').classList.add('active');
        }

        // ÁõÆÊ®ôÈÄ≤ÊçóÊõ¥Êñ∞
        function updateGoalProgress() {
            if (!targetGoal || dailyData.length === 0) return;

            // ÁèæÂú®„ÅÆ‰ΩìÈáçÔºàÊúÄÊñ∞Ë®òÈå≤Ôºâ
            const sortedData = [...dailyData].sort((a, b) => new Date(b.date) - new Date(a.date));
            const currentWeight = sortedData[0].weight;
            
            // Êó•Êï∞Ë®àÁÆó
            const today = new Date();
            const targetDate = new Date('2025-10-18');
            const startDate = new Date(targetGoal.setDate);
            const totalDays = Math.ceil((targetDate - startDate) / (1000 * 60 * 60 * 24));
            const elapsedDays = Math.ceil((today - startDate) / (1000 * 60 * 60 * 24));
            const remainingDays = Math.max(0, Math.ceil((targetDate - today) / (1000 * 60 * 60 * 24)));
            
            // Ê∏õÈáèË®àÁÆó
            const totalWeightToLose = targetGoal.startWeight - targetGoal.targetWeight;
            const currentWeightLoss = targetGoal.startWeight - currentWeight;
            const remainingWeight = currentWeight - targetGoal.targetWeight;
            const dailyTarget = remainingWeight > 0 ? (remainingWeight / Math.max(1, remainingDays)).toFixed(3) : 0;
            
            // ÈÄ≤ÊçóÁéáË®àÁÆó
            const daysProgress = Math.min(100, Math.max(0, (elapsedDays / totalDays) * 100));
            const weightProgress = totalWeightToLose > 0 ? Math.max(0, (currentWeightLoss / totalWeightToLose) * 100) : 0;
            const isCompleted = currentWeight <= targetGoal.targetWeight;

            // Ë°®Á§∫Êõ¥Êñ∞
            document.getElementById('goal-title').textContent = `üéØ ÁõÆÊ®ô: ${targetGoal.targetWeight}kg`;
            document.getElementById('remaining-days').textContent = `${remainingDays}Êó•`;
            document.getElementById('remaining-weight').textContent = isCompleted ? 'ÈÅîÊàêÔºÅ' : `${remainingWeight.toFixed(1)}kg`;
            document.getElementById('current-weight-display').textContent = `${currentWeight}kg`;
            document.getElementById('daily-target').textContent = isCompleted ? 'ÈÅîÊàêÔºÅ' : `${dailyTarget}kg/Êó•`;
            
            // Êó•Êï∞ÈÄ≤Êçó
            document.getElementById('days-progress-text').textContent = `${Math.round(daysProgress)}%`;
            document.getElementById('days-progress-bar').style.width = `${daysProgress}%`;
            
            // Ê∏õÈáèÈÄ≤Êçó
            if (isCompleted) {
                document.getElementById('weight-progress-label').textContent = 'üéâ Ê∏õÈáèÈÅîÊàê';
                document.getElementById('weight-progress-text').textContent = 'ClearÔºÅ';
                document.getElementById('weight-progress-bar').classList.add('completed');
                document.getElementById('weight-progress-bar').style.width = '100%';
                document.getElementById('clear-achievement').style.display = 'block';
            } else {
                document.getElementById('weight-progress-label').textContent = '‚öñÔ∏è Ê∏õÈáèÈÄ≤Êçó';
                document.getElementById('weight-progress-text').textContent = `${Math.round(weightProgress)}%`;
                document.getElementById('weight-progress-bar').classList.remove('completed');
                document.getElementById('weight-progress-bar').style.width = `${Math.min(100, weightProgress)}%`;
                document.getElementById('clear-achievement').style.display = 'none';
            }
        }

        // Êó•Ê¨°„Éá„Éº„ÇøÈÄÅ‰ø°Âá¶ÁêÜ
        async function handleDailySubmit(e) {
            e.preventDefault();
            
            const formData = {
                date: document.getElementById('daily-date').value,
                weight: parseFloat(document.getElementById('weight').value),
                calories: parseInt(document.getElementById('calories').value),
                steps: parseInt(document.getElementById('steps').value),
                event: document.getElementById('event').value
            };

            // ÂÖ•ÂäõÂÄ§„ÅÆÂÜçÊ§úË®º
            if (formData.weight < 40 || formData.weight > 150) {
                showStatus('‰ΩìÈáç„ÅØ40kg„Äú150kg„ÅÆÁØÑÂõ≤„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }
            if (formData.calories < 800 || formData.calories > 5000) {
                showStatus('ÊëÇÂèñ„Ç´„É≠„É™„Éº„ÅØ800„Äú5000kcal„ÅÆÁØÑÂõ≤„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }
            if (formData.steps < 0 || formData.steps > 50000) {
                showStatus('Ê≠©Êï∞„ÅØ0„Äú50000Ê≠©„ÅÆÁØÑÂõ≤„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/save-daily-data`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    const result = await response.json();
                    showStatus('Êó•Ê¨°„Éá„Éº„Çø„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
                    loadAllData(); // „Éá„Éº„Çø„ÇíÂÜçË™≠„ÅøËæº„Åø
                    updateGoalProgressWithDetails(); // ÁõÆÊ®ôÈÄ≤Êçó„Å®‰∫àÊ∏¨Ë©≥Á¥∞„ÇíÊõ¥Êñ∞
                    clearDailyForm();
                } else {
                    throw new Error('‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            } catch (error) {
                console.error('‰øùÂ≠ò„Ç®„É©„Éº:', error);
                showStatus('„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
            }
        }

        // „Éà„É¨„Éº„Éã„É≥„Ç∞„Éá„Éº„ÇøÈÄÅ‰ø°Âá¶ÁêÜ
        async function handleTrainingSubmit(e) {
            e.preventDefault();
            
            const weight = parseFloat(document.getElementById('training-weight').value);
            const reps = parseInt(document.getElementById('reps').value);
            const sets = parseInt(document.getElementById('sets').value);
            const exercise = document.getElementById('exercise').value;

            // ÂÖ•ÂäõÂÄ§„ÅÆÂÜçÊ§úË®º
            if (weight < 1 || weight > 300) {
                showStatus('ÈáçÈáè„ÅØ1kg„Äú300kg„ÅÆÁØÑÂõ≤„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }
            
            const formData = {
                date: document.getElementById('training-date').value,
                exercise: exercise,
                weight: weight,
                reps: reps,
                sets: sets,
                bodyPart: getBodyPart(exercise),
                intensity: calculateIntensity(weight, reps, sets)
            };

            try {
                const response = await fetch(`${API_BASE}/save-training-data`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    const result = await response.json();
                    showStatus('„Éà„É¨„Éº„Éã„É≥„Ç∞„Éá„Éº„Çø„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
                    loadAllData(); // „Éá„Éº„Çø„ÇíÂÜçË™≠„ÅøËæº„Åø
                    clearTrainingForm();
                } else {
                    throw new Error('‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            } catch (error) {
                console.error('‰øùÂ≠ò„Ç®„É©„Éº:', error);
                showStatus('„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
            }
        }

        // ÈÉ®‰ΩçÂà§ÂÆöÈñ¢Êï∞
        function getBodyPart(exercise) {
            const bodyPartMap = {
                '„Éô„É≥„ÉÅ„Éó„É¨„Çπ': 'ËÉ∏', '„Éö„ÉÉ„ÇØ„Éï„É©„Ç§': 'ËÉ∏', '„Éá„Ç£„ÉÉ„Éó„Çπ': 'ËÉ∏', '„Éá„ÇØ„É©„Ç§„É≥„Éó„É¨„Çπ': 'ËÉ∏',
                '„É©„ÉÉ„Éà„Éó„É´„ÉÄ„Ç¶„É≥': 'ËÉå‰∏≠', 'DY„É≠„Éº„Ç§„É≥„Ç∞': 'ËÉå‰∏≠', 'T„Éê„Éº„É≠„Éº„Ç§„É≥„Ç∞': 'ËÉå‰∏≠', '„ÉÅ„É≥„Éã„É≥„Ç∞': 'ËÉå‰∏≠', '„Éá„ÉÉ„Éâ„É™„Éï„Éà': 'ËÉå‰∏≠',
                '„Éû„Ç∑„É≥„Ç∑„Éß„É´„ÉÄ„Éº„Éó„É¨„Çπ': 'ËÇ©', '„ÉÄ„É≥„Éô„É´„Çµ„Ç§„Éâ„É¨„Ç§„Ç∫': 'ËÇ©', '„ÉÄ„É≥„Éô„É´„É™„Ç¢„É¨„Ç§„Ç∫': 'ËÇ©',
                '„Ç§„É≥„ÇØ„É©„Ç§„É≥„ÉÄ„É≥„Éô„É´„Ç´„Éº„É´': 'ËÖï',
                '„Çπ„ÇØ„ÉØ„ÉÉ„Éà': 'ËÑö', '„Éè„ÉÉ„ÇØ„Çπ„ÇØ„ÉØ„ÉÉ„Éà': 'ËÑö', '45Â∫¶„É¨„ÉÉ„Ç∞„Éó„É¨„Çπ': 'ËÑö'
            };
            return bodyPartMap[exercise] || '„Åù„ÅÆ‰ªñ';
        }

        // Âº∑Â∫¶Ë®àÁÆóÈñ¢Êï∞
        function calculateIntensity(weight, reps, sets) {
            const totalVolume = weight * reps * sets;
            if (totalVolume >= 3000) return 'È´ò';
            if (totalVolume >= 1500) return '‰∏≠';
            return '‰Ωé';
        }

        // „Éï„Ç©„Éº„É†„ÇØ„É™„Ç¢
        function clearDailyForm() {
            document.getElementById('daily-form').reset();
            setupDateDefaults();
        }

        function clearTrainingForm() {
            document.getElementById('training-form').reset();
            setupDateDefaults();
        }

        // Êó•‰ªò„Éï„Ç©„Éº„Éû„ÉÉ„ÉàÈñ¢Êï∞
        function formatDateWithDay(dateStr) {
            const date = new Date(dateStr + 'T00:00:00');
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const dayNames = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];
            const dayOfWeek = dayNames[date.getDay()];
            
            let className = '';
            if (date.getDay() === 6) {
                className = 'saturday';
            } else if (date.getDay() === 0 || holidays2025.includes(dateStr)) {
                className = 'sunday-holiday';
            }
            
            return {
                formatted: `${month}/${day}(${dayOfWeek})`,
                className: className
            };
        }

        // Ê∂àË≤ª„Ç´„É≠„É™„ÉºË®àÁÆó
        function calculateWalkingCalories(steps) {
            return Math.round(steps * 0.04);
        }

        function calculateTrainingCalories(date) {
            const dayTraining = trainingData.filter(t => t.date === date);
            let totalCalories = 0;
            
            dayTraining.forEach(training => {
                const calories = calculatePreciseExerciseCalories(training.exercise, training.weight, training.reps, training.sets);
                totalCalories += calories;
            });
            
            return Math.round(totalCalories);
        }

        // Á≤æÁ∑ª„Å™Á≠ã„Éà„É¨Ê∂àË≤ª„Ç´„É≠„É™„ÉºË®àÁÆóÔºà„ÇÜ„Å£„Åè„Çä‰∏ÅÂØßÂãï‰ΩúÁâàÔºâ
        
        // Á®ÆÁõÆÂà•METsÂÄ§ÔºàÊñáÁåÆ„Éô„Éº„ÇπÔºâ
        const exerciseMETs = {
            '„Éá„ÉÉ„Éâ„É™„Éï„Éà': 8.0,
            '„Çπ„ÇØ„ÉØ„ÉÉ„Éà': 7.5,
            '„Éô„É≥„ÉÅ„Éó„É¨„Çπ': 6.5,
            '„Éè„ÉÉ„ÇØ„Çπ„ÇØ„ÉØ„ÉÉ„Éà': 7.0,
            '45Â∫¶„É¨„ÉÉ„Ç∞„Éó„É¨„Çπ': 6.5,
            '„É©„ÉÉ„Éà„Éó„É´„ÉÄ„Ç¶„É≥': 6.0,
            'DY„É≠„Éº„Ç§„É≥„Ç∞': 6.5,
            'T„Éê„Éº„É≠„Éº„Ç§„É≥„Ç∞': 6.0,
            '„ÉÅ„É≥„Éã„É≥„Ç∞': 7.0,
            '„Éá„Ç£„ÉÉ„Éó„Çπ': 6.5,
            '„Éû„Ç∑„É≥„Ç∑„Éß„É´„ÉÄ„Éº„Éó„É¨„Çπ': 5.5,
            '„Éö„ÉÉ„ÇØ„Éï„É©„Ç§': 5.0,
            '„Éá„ÇØ„É©„Ç§„É≥„Éó„É¨„Çπ': 6.0,
            '„ÉÄ„É≥„Éô„É´„Çµ„Ç§„Éâ„É¨„Ç§„Ç∫': 4.5,
            '„ÉÄ„É≥„Éô„É´„É™„Ç¢„É¨„Ç§„Ç∫': 4.0,
            '„Ç§„É≥„ÇØ„É©„Ç§„É≥„ÉÄ„É≥„Éô„É´„Ç´„Éº„É´': 4.5
        };
        
        // „ÇÜ„Å£„Åè„Çä‰∏ÅÂØß„Å™Âãï‰ΩúÊôÇÈñìÔºàÁßí/ÂõûÔºâ
        const slowTimePerRep = {
            '„Éá„ÉÉ„Éâ„É™„Éï„Éà': 8.0,           // ‰∏ãÈôç3Áßí+ÂÅúÊ≠¢1Áßí+Êåô‰∏ä3Áßí+„É™„Çª„ÉÉ„Éà1Áßí
            '„Çπ„ÇØ„ÉØ„ÉÉ„Éà': 6.0,             // ‰∏ãÈôç2.5Áßí+ÂÅúÊ≠¢1Áßí+Êåô‰∏ä2.5Áßí
            '„Éô„É≥„ÉÅ„Éó„É¨„Çπ': 6.0,           // ‰∏ãÈôç2.5Áßí+ÂÅúÊ≠¢1Áßí+Êåô‰∏ä2.5Áßí
            '„Éè„ÉÉ„ÇØ„Çπ„ÇØ„ÉØ„ÉÉ„Éà': 5.5,       // ‰∏ãÈôç2Áßí+ÂÅúÊ≠¢1Áßí+Êåô‰∏ä2.5Áßí
            '45Â∫¶„É¨„ÉÉ„Ç∞„Éó„É¨„Çπ': 5.0,       // ‰∏ãÈôç2Áßí+ÂÅúÊ≠¢1Áßí+Êåô‰∏ä2Áßí
            '„É©„ÉÉ„Éà„Éó„É´„ÉÄ„Ç¶„É≥': 4.5,       // Âºï„Åç2Áßí+ÂÅúÊ≠¢0.5Áßí+Êàª„Åó2Áßí
            'DY„É≠„Éº„Ç§„É≥„Ç∞': 5.0,           // Âºï„Åç2Áßí+ÂÅúÊ≠¢1Áßí+Êàª„Åó2Áßí
            'T„Éê„Éº„É≠„Éº„Ç§„É≥„Ç∞': 5.0,        // Âºï„Åç2Áßí+ÂÅúÊ≠¢1Áßí+Êàª„Åó2Áßí
            '„ÉÅ„É≥„Éã„É≥„Ç∞': 6.0,             // ‰∏äÊòá2.5Áßí+ÂÅúÊ≠¢1Áßí+‰∏ãÈôç2.5Áßí
            '„Éá„Ç£„ÉÉ„Éó„Çπ': 5.5,             // ‰∏ãÈôç2Áßí+ÂÅúÊ≠¢1Áßí+Êåô‰∏ä2.5Áßí
            '„Éû„Ç∑„É≥„Ç∑„Éß„É´„ÉÄ„Éº„Éó„É¨„Çπ': 4.5, // Êåô‰∏ä2Áßí+ÂÅúÊ≠¢0.5Áßí+‰∏ãÈôç2Áßí
            '„Éö„ÉÉ„ÇØ„Éï„É©„Ç§': 4.0,           // Èñâ„Åò1.5Áßí+ÂÅúÊ≠¢1Áßí+Èñã„Åç1.5Áßí
            '„Éá„ÇØ„É©„Ç§„É≥„Éó„É¨„Çπ': 5.5,       // ‰∏ãÈôç2Áßí+ÂÅúÊ≠¢1Áßí+Êåô‰∏ä2.5Áßí
            '„ÉÄ„É≥„Éô„É´„Çµ„Ç§„Éâ„É¨„Ç§„Ç∫': 4.0,   // Êåô‰∏ä1.5Áßí+ÂÅúÊ≠¢1Áßí+‰∏ãÈôç1.5Áßí
            '„ÉÄ„É≥„Éô„É´„É™„Ç¢„É¨„Ç§„Ç∫': 3.5,     // Êåô‰∏ä1.5Áßí+ÂÅúÊ≠¢0.5Áßí+‰∏ãÈôç1.5Áßí
            '„Ç§„É≥„ÇØ„É©„Ç§„É≥„ÉÄ„É≥„Éô„É´„Ç´„Éº„É´': 4.5 // Â∑ª„Åç‰∏ä„Åí2Áßí+ÂÅúÊ≠¢0.5Áßí+‰∏ãÈôç2Áßí
        };
        
        // Á®ÆÁõÆÂà•Âπ≥Âùá1RMÔºàÁî∑ÊÄß176cm/70kgÂü∫Ê∫ñÔºâ
        const average1RM = {
            '„Éô„É≥„ÉÅ„Éó„É¨„Çπ': 85,
            '„Çπ„ÇØ„ÉØ„ÉÉ„Éà': 115,
            '„Éá„ÉÉ„Éâ„É™„Éï„Éà': 135,
            '„Éè„ÉÉ„ÇØ„Çπ„ÇØ„ÉØ„ÉÉ„Éà': 100,
            '45Â∫¶„É¨„ÉÉ„Ç∞„Éó„É¨„Çπ': 150,
            '„É©„ÉÉ„Éà„Éó„É´„ÉÄ„Ç¶„É≥': 65,
            'DY„É≠„Éº„Ç§„É≥„Ç∞': 70,
            'T„Éê„Éº„É≠„Éº„Ç§„É≥„Ç∞': 65,
            '„ÉÅ„É≥„Éã„É≥„Ç∞': 70,
            '„Éá„Ç£„ÉÉ„Éó„Çπ': 70,
            '„Éû„Ç∑„É≥„Ç∑„Éß„É´„ÉÄ„Éº„Éó„É¨„Çπ': 55,
            '„Éö„ÉÉ„ÇØ„Éï„É©„Ç§': 45,
            '„Éá„ÇØ„É©„Ç§„É≥„Éó„É¨„Çπ': 80,
            '„ÉÄ„É≥„Éô„É´„Çµ„Ç§„Éâ„É¨„Ç§„Ç∫': 20,
            '„ÉÄ„É≥„Éô„É´„É™„Ç¢„É¨„Ç§„Ç∫': 15,
            '„Ç§„É≥„ÇØ„É©„Ç§„É≥„ÉÄ„É≥„Éô„É´„Ç´„Éº„É´': 25
        };
        
        // ÁèæÂú®„ÅÆ‰ΩìÈáçÂèñÂæó
        function getCurrentWeight() {
            if (dailyData.length === 0) return 70; // „Éá„Éï„Ç©„É´„Éà
            const sortedData = [...dailyData].sort((a, b) => new Date(b.date) - new Date(a.date));
            return sortedData[0].weight;
        }
        
        // „Çª„ÉÉ„ÉàÈñì„É¨„Çπ„ÉàÊôÇÈñìË®àÁÆóÔºà„ÇÜ„Å£„Åè„Çä‰∏ÅÂØß=„Çà„ÇäÁñ≤Âä¥„Åô„Çã„Åü„ÇÅÈï∑„ÇÅ„Å´Ôºâ
        function getRestTime(exercise, reps) {
            // Â§ßÁ≠ãÁæ§„ÉªÈ´òÂº∑Â∫¶Á®ÆÁõÆ„ÅØÈï∑„ÇÅ„ÅÆ„É¨„Çπ„Éà
            if (['„Éá„ÉÉ„Éâ„É™„Éï„Éà', '„Çπ„ÇØ„ÉØ„ÉÉ„Éà', '„Éô„É≥„ÉÅ„Éó„É¨„Çπ'].includes(exercise)) {
                return 210; // 3.5ÂàÜÔºàÈÄöÂ∏∏„Çà„Çä30ÁßíÈï∑„ÅèÔºâ
            } else if (reps <= 6) {
                return 180; // 3ÂàÜÔºàÈÄöÂ∏∏„Çà„Çä30ÁßíÈï∑„ÅèÔºâ
            } else if (reps <= 12) {
                return 150; // 2.5ÂàÜÔºàÈÄöÂ∏∏„Çà„Çä30ÁßíÈï∑„ÅèÔºâ
            } else {
                return 120; // 2ÂàÜÔºàÈÄöÂ∏∏„Çà„Çä30ÁßíÈï∑„ÅèÔºâ
            }
        }
        
        // ÂÆüÂÉçÊôÇÈñì„Éª„É¨„Çπ„ÉàÊôÇÈñìË®àÁÆó
        function calculateWorkoutTimes(exercise, reps, sets) {
            const repTime = slowTimePerRep[exercise] || 4.0;
            const activeTimeSeconds = reps * repTime * sets;
            const restTimePerSet = getRestTime(exercise, reps);
            const totalRestTimeSeconds = restTimePerSet * (sets - 1);
            
            return {
                activeMinutes: activeTimeSeconds / 60,
                restMinutes: totalRestTimeSeconds / 60,
                totalMinutes: (activeTimeSeconds + totalRestTimeSeconds) / 60
            };
        }
        
        // Âº∑Â∫¶‰øÇÊï∞Ë®àÁÆó
        function calculateIntensityFactor(weight, reps, exercise) {
            // 1RMÊé®ÂÆöÔºàBrzyckiÂºèÔºâ
            const estimated1RM = weight * (36 / (37 - reps));
            
            // Áõ∏ÂØæÂº∑Â∫¶
            const avgRM = average1RM[exercise] || 60;
            const relativeStrength = estimated1RM / avgRM;
            
            // Ë£úÊ≠£‰øÇÊï∞Ôºà0.7-1.5ÂÄçÔºâ
            return Math.max(0.7, Math.min(1.5, 0.8 + relativeStrength * 0.4));
        }
        
        // Á≤æÁ∑ª„Å™Á≠ã„Éà„É¨Ê∂àË≤ª„Ç´„É≠„É™„ÉºË®àÁÆóÔºà„ÇÜ„Å£„Åè„Çä‰∏ÅÂØßÁâàÔºâ
        function calculatePreciseExerciseCalories(exercise, weight, reps, sets) {
            const bodyWeight = getCurrentWeight();
            
            // 1. ÊôÇÈñìË®àÁÆóÔºàÂÆüÂÉç„Å®„É¨„Çπ„ÉàÂàÜÈõ¢Ôºâ
            const times = calculateWorkoutTimes(exercise, reps, sets);
            
            // 2. ÂÆüÂÉçÊôÇÊ∂àË≤ª„Ç´„É≠„É™„ÉºÔºàÈ´òMETsÔºâ
            const METs = exerciseMETs[exercise] || 5.0;
            const activeCalories = METs * bodyWeight * (times.activeMinutes / 60) * 1.05;
            
            // 3. „É¨„Çπ„ÉàÊôÇÊ∂àË≤ª„Ç´„É≠„É™„ÉºÔºàÂü∫Á§é‰ª£Ë¨ù„É¨„Éô„É´Ôºâ
            const restCalories = 1.2 * bodyWeight * (times.restMinutes / 60) * 1.05;
            
            // 4. Âº∑Â∫¶Ë£úÊ≠£ÔºàÂÆüÂÉçÂàÜ„ÅÆ„ÅøÔºâ
            const intensityFactor = calculateIntensityFactor(weight, reps, exercise);
            const adjustedActiveCalories = activeCalories * intensityFactor;
            
            // 5. „ÇÜ„Å£„Åè„Çä‰∏ÅÂØßÂãï‰Ωú„Å´„Çà„ÇãËøΩÂä†ÂäπÊûúÔºà+10%Ôºâ
            const slowMotionBonus = 1.10;
            
            // 6. EPOCÂäπÊûúÔºàÊéß„Åà„ÇÅ„Å´5%Ôºâ
            const epocMultiplier = 1.05;
            
            // 7. ÊúÄÁµÇË®àÁÆó
            const totalCalories = (adjustedActiveCalories + restCalories) * slowMotionBonus * epocMultiplier;
            
            return Math.max(1, Math.round(totalCalories));
        }

        // Á≠ã„Éà„É¨ÂÆüÊñΩÊó•Âà§ÂÆö
        function hasTrainingOnDate(date) {
            return trainingData.some(t => t.date === date);
        }

        // ÊúÄÂ∞è‰ΩìÈáçË®òÈå≤„ÅÆÂèñÂæó
        function getMinimumWeight(currentDate) {
            const sortedData = [...dailyData]
                .filter(item => item.date <= currentDate)
                .sort((a, b) => a.weight - b.weight);
            return sortedData.length > 0 ? sortedData[0].weight : null;
        }

        function isMinimumWeight(weight, date) {
            const minWeight = getMinimumWeight(date);
            return minWeight !== null && weight === minWeight;
        }

        // Á≤æÁ∑ª„Å™‰ΩìÈáç‰∫àÊ∏¨„Ç∑„Çπ„ÉÜ„É†
        
        // „Éè„É™„Çπ„Éª„Éô„Éç„Éá„Ç£„ÇØ„ÉàÂºè„Å´„Çà„ÇãÂü∫Á§é‰ª£Ë¨ùË®àÁÆó
        function calculateBMR(weight, height, age) {
            // Áî∑ÊÄßÁî®„ÅÆÂºè
            return 88.362 + (13.397 * weight) + (4.799 * height) - (5.677 * age);
        }
        
        // ÊåáÊï∞Âπ≥ÊªëÂåñÊ≥ï„Å´„Çà„ÇãÈáç„Åø‰ªò„ÅëÂπ≥Âùá
        function calculateWeightedAverage(data, valueKey, alpha = 0.5) {
            if (data.length === 0) return 0;
            
            const sortedData = [...data].sort((a, b) => new Date(a.date) - new Date(b.date));
            let weightedValue = sortedData[0][valueKey];
            
            for (let i = 1; i < sortedData.length; i++) {
                weightedValue = alpha * sortedData[i][valueKey] + (1 - alpha) * weightedValue;
            }
            
            return weightedValue;
        }
        
        // ‰ª£Ë¨ùÈÅ©ÂøúË®àÁÆó
        function calculateMetabolicAdaptation(startWeight, currentWeight, daysElapsed) {
            const weightLossPercent = ((startWeight - currentWeight) / startWeight) * 100;
            const timeFactor = Math.min(daysElapsed / 90, 1); // 90Êó•„ÅßÊúÄÂ§ßÈÅ©Âøú
            
            let metabolicReduction = 0;
            if (weightLossPercent >= 10) {
                metabolicReduction = 0.05 + (weightLossPercent - 10) * 0.01;
            } else if (weightLossPercent >= 5) {
                metabolicReduction = (weightLossPercent - 5) * 0.01;
            }
            
            const adaptationFactor = metabolicReduction * timeFactor;
            return Math.min(adaptationFactor, 0.15); // ÊúÄÂ§ß15%
        }
        
        // Á≠ã„Éà„É¨„Å´„Çà„Çã‰ª£Ë¨ùÂêë‰∏äÂäπÊûú
        function calculateTrainingMetabolicBoost(trainingData, currentDate) {
            let totalBoost = 0;
            
            // 1. EPOCÂäπÊûúÔºàÈÅéÂéª48ÊôÇÈñìÔºâ
            const recentTraining = trainingData.filter(t => {
                const daysDiff = (currentDate - new Date(t.date)) / (1000 * 60 * 60 * 24);
                return daysDiff <= 2;
            });
            
            recentTraining.forEach(training => {
                const daysSince = (currentDate - new Date(training.date)) / (1000 * 60 * 60 * 24);
                const intensity = calculateIntensity(training.weight, training.reps, training.sets);
                
                let epocEffect = 0;
                if (intensity === 'È´ò') {
                    epocEffect = 150 * Math.exp(-daysSince / 1.2);
                } else if (intensity === '‰∏≠') {
                    epocEffect = 80 * Math.exp(-daysSince / 1.0);
                } else {
                    epocEffect = 40 * Math.exp(-daysSince / 0.8);
                }
                
                totalBoost += epocEffect;
            });
            
            // 2. Èï∑ÊúüÁöÑÁ≠ãËÇâÈáèÂ¢óÂä†ÂäπÊûú
            const monthlyTraining = trainingData.filter(t => {
                const daysDiff = (currentDate - new Date(t.date)) / (1000 * 60 * 60 * 24);
                return daysDiff <= 30;
            });
            
            const trainingFrequency = monthlyTraining.length;
            let muscleGainFactor = 0;
            
            if (trainingFrequency >= 20) {
                muscleGainFactor = 0.5;
            } else if (trainingFrequency >= 12) {
                muscleGainFactor = 0.3;
            } else if (trainingFrequency >= 8) {
                muscleGainFactor = 0.2;
            } else if (trainingFrequency >= 4) {
                muscleGainFactor = 0.1;
            }
            
            // ÈñãÂßã„Åã„Çâ„ÅÆÁµåÈÅéÊúàÊï∞ÔºàÊúÄÂ§ß6„É∂ÊúàÔºâ
            if (trainingData.length > 0) {
                const startDate = new Date(Math.min(...trainingData.map(t => new Date(t.date))));
                const monthsElapsed = Math.min((currentDate - startDate) / (1000 * 60 * 60 * 24 * 30), 6);
                const totalMuscleGain = muscleGainFactor * monthsElapsed;
                const muscleMetabolicBoost = totalMuscleGain * 13;
                totalBoost += muscleMetabolicBoost;
            }
            
            return Math.round(totalBoost);
        }
        
        // Á≤æÂØÜ‰ΩìÈáç‰∫àÊ∏¨Ë®àÁÆó
        function calculatePreciseWeightPrediction(weightData) {
            if (weightData.length < 2) {
                return {
                    predictedWeight: weightData.length > 0 ? weightData[weightData.length - 1].weight : null,
                    currentWeight: weightData.length > 0 ? weightData[weightData.length - 1].weight : null
                };
            }

            const currentWeight = getCurrentWeight();
            const today = new Date();
            const targetDate = new Date('2025-10-18');
            const remainingDays = Math.max(0, Math.ceil((targetDate - today) / (1000 * 60 * 60 * 24)));
            
            if (remainingDays === 0) {
                return {
                    predictedWeight: currentWeight,
                    currentWeight: currentWeight
                };
            }
            
            // 1. Âü∫Á§é‰ª£Ë¨ùË®àÁÆó
            const baseBMR = calculateBMR(currentWeight, USER_PROFILE.height, USER_PROFILE.age);
            
            // 2. ‰ª£Ë¨ùÈÅ©ÂøúÔºàÁõÆÊ®ôË®≠ÂÆö„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆ„ÅøÔºâ
            let adaptation = 0;
            if (targetGoal) {
                const startDate = new Date(targetGoal.setDate);
                const daysElapsed = Math.ceil((today - startDate) / (1000 * 60 * 60 * 24));
                adaptation = calculateMetabolicAdaptation(targetGoal.startWeight, currentWeight, daysElapsed);
            }
            const adaptedBMR = baseBMR * (1 - adaptation);
            
            // 3. Á≠ã„Éà„É¨„Å´„Çà„Çã‰ª£Ë¨ùÂêë‰∏ä
            const trainingBoost = calculateTrainingMetabolicBoost(trainingData, today);
            const finalBMR = adaptedBMR + trainingBoost;
            
            // 4. Áõ¥Ëøë„Éá„Éº„Çø„ÅÆÈáç„Åø‰ªò„ÅëÂπ≥ÂùáÔºàÈÅéÂéª30Êó•Ôºâ
            const recentData = dailyData.filter(d => {
                const daysDiff = (today - new Date(d.date)) / (1000 * 60 * 60 * 24);
                return daysDiff <= 30;
            });
            
            if (recentData.length === 0) {
                return {
                    predictedWeight: currentWeight,
                    currentWeight: currentWeight
                };
            }
            
            const avgIntakeCalories = calculateWeightedAverage(recentData, 'calories', 0.5);
            
            // ÈÅãÂãïÊ∂àË≤ª„Ç´„É≠„É™„ÉºÔºàÊ≠©Ë°å + Á≠ã„Éà„É¨Ôºâ
            const avgExerciseCalories = recentData.map(d => {
                const walkingCal = calculateWalkingCalories(d.steps);
                const trainingCal = calculateTrainingCalories(d.date);
                return { date: d.date, totalBurn: walkingCal + trainingCal };
            });
            const avgBurnedCalories = calculateWeightedAverage(avgExerciseCalories, 'totalBurn', 0.5);
            
            // 5. Êó•Ê¨°„Ç´„É≠„É™„ÉºÂèéÊîØ
            const dailyDeficit = finalBMR + avgBurnedCalories - avgIntakeCalories;
            
            // 6. ‰∫àÊ∏¨Ë®àÁÆó
            const predictedWeightLoss = (dailyDeficit * remainingDays) / 7200; // 1kg = 7200kcal
            const predictedWeight = currentWeight - predictedWeightLoss;
            
            return {
                predictedWeight: Math.max(40, predictedWeight), // ÊúÄ‰Ωé40kg
                currentWeight: currentWeight
            };
        }

// „Éó„É©„Éà„ÉºÊ§úÂá∫„ÉªÂ§ñ„ÇåÂÄ§Èô§Âéª„ÉªË©≥Á¥∞Á≠ã„Éà„É¨ÂäπÊûúÂàÜÊûê„Ç∑„Çπ„ÉÜ„É†
        
        // 1. Á∑öÂΩ¢ÂõûÂ∏∞ÂàÜÊûê„Å´„Çà„Çã„Éó„É©„Éà„ÉºÊ§úÂá∫
        function detectPlateau(weightData) {
            if (weightData.length < 14) return { isPlateau: false, slope: null };
            
            // ÈÅéÂéª14Êó•„ÅÆ„Éá„Éº„Çø„ÇíÂèñÂæó
            const recentData = weightData
                .slice(-14)
                .map((item, index) => ({ x: index, y: item.weight }));
            
            // Á∑öÂΩ¢ÂõûÂ∏∞Ë®àÁÆó
            const n = recentData.length;
            const sumX = recentData.reduce((sum, point) => sum + point.x, 0);
            const sumY = recentData.reduce((sum, point) => sum + point.y, 0);
            const sumXY = recentData.reduce((sum, point) => sum + (point.x * point.y), 0);
            const sumXX = recentData.reduce((sum, point) => sum + (point.x * point.x), 0);
            
            const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
            const isPlateau = Math.abs(slope) < 0.02; // 0.02kg/Êó•Êú™Ê∫Ä„Çí„Éó„É©„Éà„ÉºÂà§ÂÆö
            
            return { isPlateau, slope };
        }
        
        // 2. ÂõõÂàÜ‰ΩçÁØÑÂõ≤Ê≥ï„Å´„Çà„ÇãÂ§ñ„ÇåÂÄ§Ê§úÂá∫
        function detectOutliers(data) {
            const calories = data.map(d => d.calories).sort((a, b) => a - b);
            const q1 = calories[Math.floor(calories.length * 0.25)];
            const q3 = calories[Math.floor(calories.length * 0.75)];
            const iqr = q3 - q1;
            const lowerBound = q1 - 1.5 * iqr;
            const upperBound = q3 + 1.5 * iqr;
            
            return {
                outlierDates: data.filter(d => 
                    d.calories < lowerBound || 
                    d.calories > upperBound ||
                    (d.event && ['„ÉÅ„Éº„Éà„Éá„Ç§', '‰ºöÈ£ü', 'È£≤„Åø‰ºö'].some(keyword => 
                        d.event.includes(keyword)))
                ).map(d => d.date),
                cleanData: data.filter(d => 
                    d.calories >= lowerBound && 
                    d.calories <= upperBound &&
                    !(d.event && ['„ÉÅ„Éº„Éà„Éá„Ç§', '‰ºöÈ£ü', 'È£≤„Åø‰ºö'].some(keyword => 
                        d.event.includes(keyword)))
                )
            };
        }
        
        // 3. Ë©≥Á¥∞Á≠ã„Éà„É¨ÂäπÊûúÂàÜÊûê
        function calculateDetailedTrainingEffect(trainingData, dailyData) {
            const today = new Date();
            const fourWeeksAgo = new Date(today.getTime() - 28 * 24 * 60 * 60 * 1000);
            
            // ÈÅéÂéª4ÈÄ±Èñì„ÅÆ„Éà„É¨„Éº„Éã„É≥„Ç∞„Éá„Éº„Çø
            const recentTraining = trainingData.filter(t => 
                new Date(t.date) >= fourWeeksAgo
            );
            
            if (recentTraining.length === 0) {
                return { weeklyFrequency: 0, balanceBonus: 0, continuityBonus: 0, totalEffect: 0 };
            }
            
            // ÈÄ±ÈñìÈ†ªÂ∫¶Ë®àÁÆó
            const weeklyFrequency = recentTraining.length / 4;
            const frequencyEffect = weeklyFrequency * 15;
            
            // „Éê„É©„É≥„Çπ„Éú„Éº„Éä„ÇπË®àÁÆóÔºàÈÉ®‰ΩçÂà•„Éê„É©„É≥„ÇπÔºâ
            const bodyParts = {};
            recentTraining.forEach(t => {
                const part = getBodyPart(t.exercise);
                bodyParts[part] = (bodyParts[part] || 0) + 1;
            });
            
            const partCounts = Object.values(bodyParts);
            const maxCount = Math.max(...partCounts);
            const minCount = Math.min(...partCounts);
            const balanceRatio = minCount / maxCount;
            const balanceBonus = balanceRatio >= 0.7 ? frequencyEffect * 0.2 : 0; // ÈÉ®‰ΩçÂ∑Æ30%‰ª•ÂÜÖ„Åß20%„Éú„Éº„Éä„Çπ
            
            // Á∂ôÁ∂öÊÄß„Éú„Éº„Éä„ÇπË®àÁÆó
            const trainingDays = [...new Set(recentTraining.map(t => t.date))];
            const continuityRate = trainingDays.length / 28; // 28Êó•‰∏≠„ÅÆÂÆüÊñΩÁéá
            const continuityBonus = continuityRate >= 0.8 ? frequencyEffect * 0.15 : 0; // Á∂ôÁ∂öÁéá80%‰ª•‰∏ä„Åß15%„Éú„Éº„Éä„Çπ
            
            const totalEffect = frequencyEffect + balanceBonus + continuityBonus;
            
            return {
                weeklyFrequency: weeklyFrequency.toFixed(1),
                balanceBonus: Math.round(balanceBonus),
                continuityBonus: Math.round(continuityBonus),
                totalEffect: Math.round(totalEffect)
            };
        }
        
        // 4. Áµ±Âêà‰∫àÊ∏¨ÂàÜÊûê
        function getAdvancedPredictionAnalysis() {
            if (dailyData.length === 0) return null;
            
            // Â§ñ„ÇåÂÄ§Èô§Âéª
            const outlierAnalysis = detectOutliers(dailyData);
            const cleanData = outlierAnalysis.cleanData;
            
            // „Éó„É©„Éà„ÉºÊ§úÂá∫
            const plateauAnalysis = detectPlateau(cleanData);
            
            // Âü∫Êú¨‰∫àÊ∏¨
            const basePrediction = calculatePreciseWeightPrediction(cleanData);
            
            // „Éó„É©„Éà„ÉºË™øÊï¥
            let adjustedPrediction = basePrediction.predictedWeight;
            if (plateauAnalysis.isPlateau) {
                adjustedPrediction += 0.5; // ‰øùÂÆàÁöÑË™øÊï¥
            }
            
            // Á≠ã„Éà„É¨ÂäπÊûúÂàÜÊûê
            const trainingEffect = calculateDetailedTrainingEffect(trainingData, dailyData);
            
            // ‰ø°È†ºÂ∫¶Ë®àÁÆó
            const dataQuality = cleanData.length >= 14 && outlierAnalysis.outlierDates.length <= 3;
            const confidence = dataQuality && !plateauAnalysis.isPlateau ? 'high' : 'low';
            
            return {
                predictedWeight: adjustedPrediction,
                confidence: confidence,
                plateau: plateauAnalysis,
                dataQuality: {
                    isGood: dataQuality,
                    outliersRemoved: outlierAnalysis.outlierDates.length
                },
                trainingEffect: trainingEffect
            };
        }        

        // Êó•Ê¨°„Éá„Éº„Çø„ÉÜ„Éº„Éñ„É´Êõ¥Êñ∞
        function updateDailyTable() {
            const tbody = document.getElementById('daily-table-body');
            tbody.innerHTML = '';

            const sortedData = [...dailyData].sort((a, b) => new Date(b.date) - new Date(a.date));

            sortedData.forEach((item, index) => {
                const row = document.createElement('tr');
                
                let weightDiff = '';
                let weightDiffClass = '';
                if (index < sortedData.length - 1) {
                    const prevWeight = sortedData[index + 1].weight;
                    const diff = item.weight - prevWeight;
                    if (diff > 0) {
                        weightDiff = `+${diff.toFixed(1)}`;
                        weightDiffClass = 'weight-increase';
                    } else if (diff < 0) {
                        weightDiff = diff.toFixed(1);
                        weightDiffClass = 'weight-decrease';
                    } else {
                        weightDiff = '¬±0.0';
                    }
                }

                const dateInfo = formatDateWithDay(item.date);
                const walkingCalories = calculateWalkingCalories(item.steps);
                const trainingCalories = calculateTrainingCalories(item.date);
                
                const isMinWeight = isMinimumWeight(item.weight, item.date);
                const weightDisplay = isMinWeight ? `${item.weight} üëë` : item.weight;

                row.innerHTML = `
                    <td class="${dateInfo.className}">${dateInfo.formatted}</td>
                    <td>${weightDisplay}</td>
                    <td class="${weightDiffClass}">${weightDiff}</td>
                    <td>${item.calories}</td>
                    <td>${item.steps.toLocaleString()}</td>
                    <td>${walkingCalories}</td>
                    <td>${trainingCalories}</td>
                    <td>${item.event || '-'}</td>
                    <td>
                        <button class="btn btn-small" onclick="editDailyData('${item.date}')">Á∑®ÈõÜ</button>
                        <button class="btn btn-small" onclick="deleteDailyData('${item.date}')">ÂâäÈô§</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // „Éà„É¨„Éº„Éã„É≥„Ç∞„Éá„Éº„Çø„ÉÜ„Éº„Éñ„É´Êõ¥Êñ∞
        function updateTrainingTable() {
            const tbody = document.getElementById('training-table-body');
            tbody.innerHTML = '';

            const sortedData = [...trainingData].sort((a, b) => new Date(b.date) - new Date(a.date));

            sortedData.forEach((item, index) => {
                const row = document.createElement('tr');
                const dateInfo = formatDateWithDay(item.date);

                row.innerHTML = `
                    <td class="${dateInfo.className}">${dateInfo.formatted}</td>
                    <td>${item.exercise}</td>
                    <td>${item.weight}</td>
                    <td>${item.reps}</td>
                    <td>${item.sets}</td>
                    <td>${item.bodyPart || getBodyPart(item.exercise)}</td>
                    <td>${item.intensity || calculateIntensity(item.weight, item.reps, item.sets)}</td>
                    <td>
                        <button class="btn btn-small" onclick="editTrainingData(${index})">Á∑®ÈõÜ</button>
                        <button class="btn btn-small" onclick="deleteTrainingData(${index})">ÂâäÈô§</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Á∑®ÈõÜÊ©üËÉΩ
        function editDailyData(date) {
            const item = dailyData.find(d => d.date === date);
            if (!item) return;

            document.getElementById('daily-date').value = item.date;
            document.getElementById('weight').value = item.weight;
            document.getElementById('calories').value = item.calories;
            document.getElementById('steps').value = item.steps;
            document.getElementById('event').value = item.event || '';

            showTab('daily');
            document.getElementById('daily-form').scrollIntoView({ behavior: 'smooth' });
            showStatus('„Éá„Éº„Çø„ÇíÁ∑®ÈõÜ„É¢„Éº„Éâ„ÅßË™≠„ÅøËæº„Åø„Åæ„Åó„Åü„ÄÇ‰øÆÊ≠£„Åó„Å¶‰øùÂ≠ò„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ', 'success');
        }

        function editTrainingData(index) {
            const item = trainingData[index];
            if (!item) return;

            document.getElementById('training-date').value = item.date;
            document.getElementById('exercise').value = item.exercise;
            document.getElementById('training-weight').value = item.weight;
            document.getElementById('reps').value = item.reps;
            document.getElementById('sets').value = item.sets;

            showTab('training');
            document.getElementById('training-form').scrollIntoView({ behavior: 'smooth' });
            showStatus('„Éá„Éº„Çø„ÇíÁ∑®ÈõÜ„É¢„Éº„Éâ„ÅßË™≠„ÅøËæº„Åø„Åæ„Åó„Åü„ÄÇ‰øÆÊ≠£„Åó„Å¶‰øùÂ≠ò„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ', 'success');
        }

        // ÂâäÈô§Âá¶ÁêÜ
        async function deleteDailyData(date) {
            if (!confirm('„Åì„ÅÆ„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) return;

            try {
                const response = await fetch(`${API_BASE}/delete-daily-data`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ date })
                });

                if (response.ok) {
                    showStatus('„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü');
                    loadAllData();
                } else {
                    throw new Error('ÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            } catch (error) {
                console.error('ÂâäÈô§„Ç®„É©„Éº:', error);
                showStatus('„Éá„Éº„Çø„ÅÆÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
            }
        }

        async function deleteTrainingData(index) {
            if (!confirm('„Åì„ÅÆ„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) return;

            try {
                const response = await fetch(`${API_BASE}/delete-training-data`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ index })
                });

                if (response.ok) {
                    showStatus('„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü');
                    loadAllData();
                } else {
                    throw new Error('ÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            } catch (error) {
                console.error('ÂâäÈô§„Ç®„É©„Éº:', error);
                showStatus('„Éá„Éº„Çø„ÅÆÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
            }
        }

        // Chart.js„Ç∞„É©„ÉïÊèèÁîªÔºà„Çπ„Éû„ÉõÊúÄÈÅ©ÂåñÁâàÔºâ
        function drawAnalysisChart() {
            const ctx = document.getElementById('analysisChart').getContext('2d');
            const isMobile = window.innerWidth <= 768;
            
            if (analysisChart) {
                analysisChart.destroy();
            }

            if (dailyData.length === 0) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.font = '16px Arial';
                ctx.fillStyle = '#666';
                ctx.textAlign = 'center';
                ctx.fillText('„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì', ctx.canvas.width / 2, ctx.canvas.height / 2);
                return;
            }

            // „Éá„Éº„ÇøÊ∫ñÂÇô
            const startDate = new Date('2025-06-01');
            const endDate = new Date('2025-10-18');
            const dateRange = [];
            const currentDate = new Date(startDate);

            while (currentDate <= endDate) {
                dateRange.push(new Date(currentDate));
                currentDate.setDate(currentDate.getDate() + 1);
            }

            const labels = dateRange.map(date => {
                const month = date.getMonth() + 1;
                const day = date.getDate();
                return `${month}/${day}`;
            });

            const weightData = [];
            const totalCaloriesData = [];
            const eventData = [];

            dateRange.forEach(date => {
                const dateStr = date.toISOString().split('T')[0];
                const dailyRecord = dailyData.find(d => d.date === dateStr);
                
                if (dailyRecord) {
                    weightData.push(dailyRecord.weight);
                    const walkingCal = calculateWalkingCalories(dailyRecord.steps);
                    const trainingCal = calculateTrainingCalories(dateStr);
                    totalCaloriesData.push(walkingCal + trainingCal);
                    eventData.push(dailyRecord.event || '');
                } else {
                    weightData.push(null);
                    totalCaloriesData.push(null);
                    eventData.push('');
                }
            });

            // ‰∫àÊ∏¨Ë®àÁÆó
            const weightPrediction = calculatePreciseWeightPrediction(dailyData);
            
            let predictionData = new Array(labels.length).fill(null);
            if (weightPrediction.predictedWeight && weightPrediction.currentWeight) {
                const currentIndex = dateRange.findIndex(date => {
                    const dateStr = date.toISOString().split('T')[0];
                    return dailyData.some(d => d.date === dateStr);
                });
                
                if (currentIndex >= 0) {
                    const endIndex = labels.length - 1;
                    predictionData[currentIndex] = weightPrediction.currentWeight;
                    predictionData[endIndex] = weightPrediction.predictedWeight;
                }
            }

            // „Çø„Ç§„Éà„É´Êõ¥Êñ∞
            const chartTitle = document.getElementById('chart-title');
            if (weightPrediction.predictedWeight) {
                chartTitle.textContent = `Â§ß‰ºöÂΩìÊó•„ÅØ${weightPrediction.predictedWeight.toFixed(1)}kg„ÅßÁùÄÂú∞Ë¶ãËæº„ÅøÔºÅÔºàÁ≤æÂØÜ‰∫àÊ∏¨Ôºâ`;
            } else {
                chartTitle.textContent = 'Â§ß‰ºöÂΩìÊó•„ÅØË®àÁÆó‰∏≠...„ÅßÁùÄÂú∞Ë¶ãËæº„ÅøÔºÅ';
            }

            // YËª∏ÁØÑÂõ≤Ë®àÁÆó
            const validWeights = weightData.filter(w => w !== null && !isNaN(w));
            let weightMin = validWeights.length > 0 ? Math.min(...validWeights) - 2 : 60;
            let weightMax = validWeights.length > 0 ? Math.max(...validWeights) + 2 : 80;
            
            if (weightPrediction.predictedWeight) {
                weightMin = Math.min(weightMin, weightPrediction.predictedWeight - 1);
                weightMax = Math.max(weightMax, weightPrediction.predictedWeight + 1);
            }

            const validCalories = totalCaloriesData.filter(c => c !== null && !isNaN(c) && c > 0);
            const caloriesMin = validCalories.length > 0 ? Math.max(0, Math.min(...validCalories) - 100) : 0;
            const caloriesMax = validCalories.length > 0 ? Math.max(...validCalories) + 100 : 1000;

            // Ëâ≤ÂàÜ„Åë
            const backgroundColors = [];
            const borderColors = [];
            
            for (let i = 0; i < dateRange.length; i++) {
                const dateStr = dateRange[i].toISOString().split('T')[0];
                const hasTraining = hasTrainingOnDate(dateStr);
                const calories = totalCaloriesData[i];
                
                if (calories && calories > 0) {
                    if (hasTraining) {
                        // Á≠ã„Éà„É¨ÂÆüÊñΩÊó•: ÊåáÂÆö„ÅÆËµ§Ëâ≤
                        backgroundColors.push('#d9333f');
                        borderColors.push('#d9333f');
                    } else {
                        // „Ç¶„Ç©„Éº„Ç≠„É≥„Ç∞„ÅÆ„Åø: Á∑ëËâ≤  
                        backgroundColors.push('rgba(16, 185, 129, 0.6)');
                        borderColors.push('#10b981');
                    }
                } else {
                    // „Éá„Éº„Çø„Å™„Åó: „Ç∞„É¨„Éº
                    backgroundColors.push('rgba(200, 200, 200, 0.3)');
                    borderColors.push('#cccccc');
                }
            }

            try {
                analysisChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: '‰ΩìÈáç (kg)',
                            data: weightData,
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderWidth: isMobile ? 3 : 2,
                            yAxisID: 'y',
                            tension: 0.1,
                            pointBackgroundColor: '#ef4444',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: isMobile ? 6 : 4,
                            spanGaps: true
                        }, {
                            label: '‰∫àÊ∏¨ÔºàÁ≤æÂØÜË®àÁÆóÔºâ',
                            data: predictionData,
                            borderColor: '#ef4444',
                            backgroundColor: 'transparent',
                            borderWidth: isMobile ? 3 : 2,
                            borderDash: [5, 5],
                            yAxisID: 'y',
                            tension: 0,
                            pointRadius: 0,
                            spanGaps: true
                        }, {
                            label: 'Á∑èÊ∂àË≤ª„Ç´„É≠„É™„Éº (kcal)',
                            data: totalCaloriesData,
                            type: 'bar',
                            backgroundColor: backgroundColors,
                            borderColor: borderColors,
                            borderWidth: 1,
                            yAxisID: 'y1'
                        }]
                    },
                    options: {
                        responsive: isMobile ? false : true,
                        maintainAspectRatio: isMobile ? false : true,
                        aspectRatio: isMobile ? undefined : 2.5/1,
                        layout: {
                            padding: {
                                top: 10,
                                bottom: isMobile ? 15 : 30,
                                left: 10,
                                right: 10
                            }
                        },
                        interaction: {
                            mode: 'index',
                            intersect: false
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    font: {
                                        size: isMobile ? 10 : 12
                                    },
                                    boxWidth: isMobile ? 12 : 16,
                                    padding: isMobile ? 8 : 15
                                }
                            },
                            tooltip: {
                                titleFont: {
                                    size: isMobile ? 11 : 12
                                },
                                bodyFont: {
                                    size: isMobile ? 10 : 11
                                },
                                callbacks: {
                                    afterBody: function(context) {
                                        const dataIndex = context[0].dataIndex;
                                        const event = eventData[dataIndex];
                                        const dateStr = dateRange[dataIndex].toISOString().split('T')[0];
                                        
                                        let tooltipText = '';
                                        if (event && context[0].datasetIndex === 0) {
                                            tooltipText += `„Ç§„Éô„É≥„Éà: ${event}`;
                                        }
                                        if (context[0].datasetIndex === 1 && dataIndex === labels.length - 1) {
                                            tooltipText += '10Êúà18Êó•„ÅÆ‰∫àÊ∏¨ÔºàÁ≤æÂØÜË®àÁÆóÔºâ';
                                        }
                                        if (context[0].datasetIndex === 2) {
                                            const hasTraining = hasTrainingOnDate(dateStr);
                                            tooltipText += hasTraining ? 'Á≠ã„Éà„É¨ÂÆüÊñΩÊó•' : '„Ç¶„Ç©„Éº„Ç≠„É≥„Ç∞„ÅÆ„Åø';
                                        }
                                        return tooltipText;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                display: true,
                                title: {
                                    display: true,
                                    text: 'Êó•‰ªò',
                                    font: {
                                        size: isMobile ? 10 : 12
                                    }
                                },
                                ticks: {
                                    font: {
                                        size: isMobile ? 8 : 10
                                    }
                                }
                            },
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: {
                                    display: true,
                                    text: '‰ΩìÈáç (kg)',
                                    font: {
                                        size: isMobile ? 10 : 12
                                    }
                                },
                                ticks: {
                                    font: {
                                        size: isMobile ? 9 : 10
                                    }
                                },
                                min: weightMin,
                                max: weightMax
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: 'Ê∂àË≤ª„Ç´„É≠„É™„Éº (kcal)',
                                    font: {
                                        size: isMobile ? 10 : 12
                                    }
                                },
                                ticks: {
                                    font: {
                                        size: isMobile ? 9 : 10
                                    }
                                },
                                grid: {
                                    drawOnChartArea: false
                                },
                                min: caloriesMin,
                                max: caloriesMax
                            }
                        }
                    }
                });
                
                // „Çπ„Éû„Éõ„Åß„ÅÆ„Åø„Ç≠„É£„É≥„Éê„Çπ„Çµ„Ç§„Ç∫„ÇíÁõ¥Êé•Â§âÊõ¥
                if (isMobile) {
                    const canvas = analysisChart.canvas;
                    const targetHeight = Math.min(Math.max(window.innerHeight * 0.6, 480), 600);
                    const targetWidth = 2400; // Âº∑Âà∂ÁöÑ„Å´Â§ß„Åç„Å™ÂπÖ„ÇíË®≠ÂÆö
                    
                    // „Ç≠„É£„É≥„Éê„Çπ„Çµ„Ç§„Ç∫„ÇíÂº∑Âà∂Ë®≠ÂÆö
                    canvas.style.height = targetHeight + 'px';
                    canvas.style.width = targetWidth + 'px';
                    canvas.width = targetWidth;
                    canvas.height = targetHeight;
                    
                    // Chart.js„ÅÆÂÜÖÈÉ®„Çµ„Ç§„Ç∫„ÇÇÂº∑Âà∂Â§âÊõ¥
                    analysisChart.canvas.parentNode.style.position = 'relative';
                    analysisChart.canvas.parentNode.style.height = targetHeight + 'px';
                    analysisChart.canvas.parentNode.style.width = targetWidth + 'px';
                    
                    // Ë¶™„Ç≥„É≥„ÉÜ„Éä„ÅÆ„Çπ„ÇØ„É≠„Éº„É´Ë®≠ÂÆö
                    const chartWrapper = canvas.parentElement;
                    chartWrapper.style.overflowX = 'scroll'; // Âº∑Âà∂„Çπ„ÇØ„É≠„Éº„É´
                    chartWrapper.style.width = '100%';
                    chartWrapper.style.height = targetHeight + 'px';
                    
                    // Chart.js„Å´Â§âÊõ¥„ÇíÂèçÊò†
                    analysisChart.resize(targetWidth, targetHeight);
                    
                    // „Çπ„Éû„ÉõÁâà„Åß„ÇÇËâ≤Ë®≠ÂÆö„ÇíÂÜçÈÅ©Áî®
                    analysisChart.data.datasets[2].backgroundColor = backgroundColors;
                    analysisChart.data.datasets[2].borderColor = borderColors;
                    analysisChart.update('none');
                }
                
            } catch (error) {
                console.error('„Ç∞„É©„Éï„ÅÆÊèèÁîª„Åß„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü:', error);
                const chartTitle = document.getElementById('chart-title');
                chartTitle.textContent = '„Ç∞„É©„Éï„ÅÆË°®Á§∫„Åß„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü';
                showStatus('„Ç∞„É©„Éï„ÅÆË°®Á§∫„Åß„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ„Éá„Éº„Çø„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ', 'error');
            }
        }

        // „Ç®„ÇØ„Çπ„Éù„Éº„ÉàÊ©üËÉΩ
        function exportDailyData() {
            const headers = ['Êó•‰ªò', '‰ΩìÈáç(kg)', 'ÊëÇÂèñ„Ç´„É≠„É™„Éº(kcal)', 'Ê≠©Êï∞', 'Ê≠©Ë°åÊ∂àË≤ª„Ç´„É≠„É™„Éº', 'Á≠ã„Éà„É¨Ê∂àË≤ª„Ç´„É≠„É™„Éº', '„Ç§„Éô„É≥„Éà'];
            
            const csvContent = [
                headers.join(','),
                ...dailyData.map(item => [
                    item.date,
                    item.weight,
                    item.calories,
                    item.steps,
                    calculateWalkingCalories(item.steps),
                    calculateTrainingCalories(item.date),
                    `"${item.event || ''}"`
                ].join(','))
            ].join('\n');

            downloadCSV(csvContent, 'daily_data.csv');
        }

        function exportTrainingData() {
            const headers = ['Êó•‰ªò', 'Á®ÆÁõÆ', 'ÈáçÈáè(kg)', 'ÂõûÊï∞', '„Çª„ÉÉ„ÉàÊï∞', 'ÈÉ®‰Ωç', 'Âº∑Â∫¶'];
            
            const csvContent = [
                headers.join(','),
                ...trainingData.map(item => [
                    item.date,
                    `"${item.exercise}"`,
                    item.weight,
                    item.reps,
                    item.sets,
                    item.bodyPart || getBodyPart(item.exercise),
                    item.intensity || calculateIntensity(item.weight, item.reps, item.sets)
                ].join(','))
            ].join('\n');

            downloadCSV(csvContent, 'training_data.csv');
        }

        function exportAllData() {
            const headers = ['Êó•‰ªò', '‰ΩìÈáç(kg)', 'ÊëÇÂèñ„Ç´„É≠„É™„Éº(kcal)', 'Ê≠©Êï∞', 'Ê≠©Ë°åÊ∂àË≤ª„Ç´„É≠„É™„Éº', 'Á≠ã„Éà„É¨Ê∂àË≤ª„Ç´„É≠„É™„Éº', '„Ç§„Éô„É≥„Éà', '„Éà„É¨„Éº„Éã„É≥„Ç∞Ë©≥Á¥∞'];
            
            const csvContent = [
                headers.join(','),
                ...dailyData.map(item => {
                    const dayTraining = trainingData.filter(t => t.date === item.date);
                    const trainingDetails = dayTraining.map(t => 
                        `${t.exercise}:${t.weight}kg√ó${t.reps}Âõû√ó${t.sets}„Çª„ÉÉ„Éà`
                    ).join(';');
                    
                    return [
                        item.date,
                        item.weight,
                        item.calories,
                        item.steps,
                        calculateWalkingCalories(item.steps),
                        calculateTrainingCalories(item.date),
                        `"${item.event || ''}"`,
                        `"${trainingDetails}"`
                    ].join(',');
                })
            ].join('\n');

            downloadCSV(csvContent, 'all_data.csv');
        }

        function downloadCSV(content, filename) {
            const BOM = '\uFEFF';
            const blob = new Blob([BOM + content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showStatus(`${filename} „Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Åæ„Åó„Åü`);
        }

        // ‰∫àÊ∏¨Ë©≥Á¥∞„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆË°®Á§∫„ÉªÊõ¥Êñ∞Ê©üËÉΩ
        
        // Êäò„Çä„Åü„Åü„ÅøÊ©üËÉΩ
        function togglePredictionDetails() {
            const content = document.getElementById('prediction-content');
            const toggle = document.getElementById('prediction-toggle');
            const details = document.getElementById('prediction-details');
            
            if (content.classList.contains('active')) {
                content.classList.remove('active');
                toggle.textContent = '‚ñº';
                details.style.display = 'none';
            } else {
                content.classList.add('active');
                toggle.textContent = '‚ñ≤';
                details.style.display = 'block';
                updatePredictionDetails(); // Ë°®Á§∫ÊôÇ„Å´Êõ¥Êñ∞
            }
        }
        
        // ‰∫àÊ∏¨Ë©≥Á¥∞„ÅÆÊõ¥Êñ∞
        function updatePredictionDetails() {
            const analysis = getAdvancedPredictionAnalysis();
            
            if (!analysis) {
                // „Éá„Éº„Çø‰∏çË∂≥ÊôÇ„ÅØÈùûË°®Á§∫
                document.getElementById('prediction-details').style.display = 'none';
                return;
            }
            
            // ‰∫àÊ∏¨Ë©≥Á¥∞„ÇíË°®Á§∫
            document.getElementById('prediction-details').style.display = 'block';
            
            // Á≤æÂØÜ‰ΩìÈáç‰∫àÊ∏¨
            const predictionEl = document.getElementById('advanced-prediction');
            predictionEl.textContent = `${analysis.predictedWeight.toFixed(1)}kg (‰ø°È†ºÂ∫¶: ${analysis.confidence === 'high' ? 'È´ò' : '‰Ωé'})`;
            predictionEl.className = `prediction-value confidence-${analysis.confidence}`;
            
            // „Éó„É©„Éà„ÉºÊ§úÂá∫
            const plateauEl = document.getElementById('plateau-status');
            if (analysis.plateau.isPlateau) {
                plateauEl.textContent = `Ê§úÂá∫ (Â§âÂåñÁéá: ${(analysis.plateau.slope * 7).toFixed(2)}kg/ÈÄ±)`;
                plateauEl.className = 'prediction-value plateau-detected';
            } else {
                plateauEl.textContent = '„Å™„Åó';
                plateauEl.className = 'prediction-value plateau-normal';
            }
            
            // „Éá„Éº„ÇøÂìÅË≥™
            const qualityEl = document.getElementById('data-quality');
            if (analysis.dataQuality.isGood) {
                qualityEl.textContent = `ËâØÂ•Ω (Â§ñ„ÇåÂÄ§${analysis.dataQuality.outliersRemoved}‰ª∂Èô§Â§ñ)`;
                qualityEl.className = 'prediction-value plateau-normal';
            } else {
                qualityEl.textContent = `Ë¶ÅÊ≥®ÊÑè (Â§ñ„ÇåÂÄ§${analysis.dataQuality.outliersRemoved}‰ª∂Èô§Â§ñ)`;
                qualityEl.className = 'prediction-value confidence-low';
            }
            
            // Á≠ã„Éà„É¨ÂäπÊûú
            const trainingEl = document.getElementById('training-effect');
            const effect = analysis.trainingEffect;
            trainingEl.textContent = `+${effect.totalEffect}kcal/Êó• (ÈÄ±${effect.weeklyFrequency}Âõû)`;
            trainingEl.className = 'prediction-value';
            
            // „Éê„É©„É≥„Çπ„ÉªÁ∂ôÁ∂öÊÄßÊÉÖÂ†±„Çí„ÉÑ„Éº„É´„ÉÅ„ÉÉ„Éó„Å®„Åó„Å¶ËøΩÂä†
            trainingEl.title = `„Éê„É©„É≥„Çπ„Éú„Éº„Éä„Çπ: +${effect.balanceBonus}kcal/Êó•, Á∂ôÁ∂öÊÄß„Éú„Éº„Éä„Çπ: +${effect.continuityBonus}kcal/Êó•`;
        }
        
        // ÁõÆÊ®ôÈÄ≤ÊçóÊõ¥Êñ∞ÊôÇ„Å´‰∫àÊ∏¨Ë©≥Á¥∞„ÇÇÊõ¥Êñ∞
        function updateGoalProgressWithDetails() {
            updateGoalProgress(); // Êó¢Â≠ò„ÅÆÈñ¢Êï∞
            updatePredictionDetails(); // Êñ∞„Åó„ÅÑË©≥Á¥∞Êõ¥Êñ∞
        }
        // „Ç¶„Ç£„É≥„Éâ„Ç¶„É™„Çµ„Ç§„Ç∫ÊôÇ„ÅÆ„Ç∞„É©„ÉïÂÜçÊèèÁîª
        let resizeTimeout;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(function() {
                if (analysisChart && document.getElementById('analysis').classList.contains('active')) {
                    drawAnalysisChart();
                }
            }, 300);
        });
// ADD HERE: Êò®Êó•„ÅÆ„Éà„É¨„Éº„Éã„É≥„Ç∞„ÇíË™≠„ÅøËæº„Çì„Åß„Éï„Ç©„Éº„É†„Å´ÂèçÊò†
function loadYesterdayTraining() {
    if (trainingData.length === 0) {
        showStatus('Êò®Êó•„ÅÆ„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì', 'error');
        return;
    }

    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);
    const yyyy = yesterday.getFullYear();
    const mm = String(yesterday.getMonth() + 1).padStart(2, '0');
    const dd = String(yesterday.getDate()).padStart(2, '0');
    const yDate = `${yyyy}-${mm}-${dd}`;

    const lastTraining = trainingData.filter(d => d.date === yDate);
    if (lastTraining.length === 0) {
        showStatus('Êò®Êó•„ÅÆ„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì', 'error');
        return;
    }

    const t = lastTraining[0];
    document.getElementById('training-date').value = yDate;
    document.getElementById('exercise').value = t.exercise;
    document.getElementById('training-weight').value = t.weight;
    document.getElementById('reps').value = t.reps;
    document.getElementById('sets').value = t.sets;

    showStatus('Êò®Êó•„ÅÆ„Éà„É¨„Éº„Éã„É≥„Ç∞ÂÜÖÂÆπ„ÇíÂèçÊò†„Åó„Åæ„Åó„Åü');
}

    </script>
</body>
</html>
