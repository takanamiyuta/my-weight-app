<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿ºã®å¤§ä¼šã¾ã§ã®é“ã®ã‚Š</title>
    <meta name="description" content="2025å¹´10æœˆ18æ—¥ã®å¤§ä¼šã«å‘ã‘ãŸä½“é‡ç®¡ç†ã¨ç­‹åŠ›ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²ã‚·ã‚¹ãƒ†ãƒ ">
    
    <!-- OGPè¨­å®š -->
    <meta property="og:title" content="ä¿ºã®å¤§ä¼šã¾ã§ã®é“ã®ã‚Š">
    <meta property="og:description" content="å¤§ä¼šã«å‘ã‘ãŸä½“é‡ç®¡ç†ã¨ç­‹åŠ›ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²ã‚·ã‚¹ãƒ†ãƒ ">
    <meta property="og:image" content="https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&h=630&q=80">
    <meta property="og:url" content="">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="ä¿ºã®å¤§ä¼šã¾ã§ã®é“ã®ã‚Š">
    
    <!-- Twitter Cardè¨­å®š -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="ä¿ºã®å¤§ä¼šã¾ã§ã®é“ã®ã‚Š">
    <meta name="twitter:description" content="å¤§ä¼šã«å‘ã‘ãŸä½“é‡ç®¡ç†ã¨ç­‹åŠ›ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²ã‚·ã‚¹ãƒ†ãƒ ">
    <meta name="twitter:image" content="https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&h=630&q=80">
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ’ª</text></svg>">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head> 
<style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .tab {
            flex: 1;
            padding: 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            color: #64748b;
            transition: all 0.3s ease;
            position: relative;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tab.active {
            color: #4f46e5;
            background: white;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #4f46e5, #7c3aed);
        }

        .tab:hover:not(.active) {
            background: #f1f5f9;
            color: #475569;
        }

        .tab .desktop-text {
            display: inline;
        }

        .tab .mobile-text {
            display: none;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }

        .form-section h3 {
            color: #1e293b;
            margin-bottom: 20px;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select {
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            min-height: 48px;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4f46e5;
        }

        .form-group input[type="number"] {
            appearance: textfield;
            -moz-appearance: textfield;
        }
        
        .form-group input[type="number"]::-webkit-outer-spin-button,
        .form-group input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .btn {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            min-height: 48px;
            min-width: 100px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(79, 70, 229, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
        }

        .btn-secondary:hover {
            box-shadow: 0 10px 20px rgba(107, 114, 128, 0.3);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.85rem;
            min-height: 36px;
            min-width: 70px;
        }
</style>
.data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .data-table th,
        .data-table td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.9rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .data-table th {
            background: #f8fafc;
            font-weight: 600;
            color: #374151;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .data-table tr:hover {
            background: #f9fafb;
        }

        .weight-increase {
            color: #dc2626;
            font-weight: 600;
        }

        .weight-decrease {
            color: #2563eb;
            font-weight: 600;
        }

        .saturday {
            color: #0095d9;
            font-weight: 600;
        }

        .sunday-holiday {
            color: #d9333f;
            font-weight: 600;
        }

        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
            overflow: hidden;
        }

        .chart-container h3 {
            color: #1e293b;
            margin-bottom: 20px;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .chart-wrapper {
            position: relative;
            height: 450px;
            width: 100%;
            padding: 10px;
        }

        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .status-success {
            background: #dcfce7;
            color: #16a34a;
            border: 1px solid #bbf7d0;
        }

        .status-error {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }

        .goal-section {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .goal-input-form {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .goal-input-form input {
            width: 100px;
            padding: 10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            color: #1f2937;
            font-size: 1rem;
            font-weight: 600;
        }

        .goal-display {
            display: none;
        }

        .goal-display.active {
            display: block;
        }

        .goal-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .goal-stat {
            text-align: center;
        }

        .goal-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .goal-stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .progress-container {
            margin: 20px 0;
        }

        .progress-item {
            margin-bottom: 15px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 6px;
            transition: width 0.3s ease;
        }

        .progress-days {
            background: linear-gradient(90deg, #3b82f6, #1d4ed8);
        }

        .progress-weight {
            background: linear-gradient(90deg, #f59e0b, #d97706);
        }

        .progress-weight.completed {
            background: linear-gradient(90deg, #ef4444, #dc2626);
        }

        .clear-achievement {
            text-align: center;
            font-size: 2rem;
            font-weight: 900;
            color: #fbbf24;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .btn-goal {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.5);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-goal:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.8);
            transform: translateY(-1px);
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .mobile-header {
            display: none;
        }

        .desktop-header {
            display: table-row;
        }

        .export-section {
            background: #f8fafc;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
    /* äºˆæ¸¬è©³ç´°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .prediction-details {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .prediction-header {
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.3s ease;
        }

        .prediction-header:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .prediction-header h4 {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0;
        }

        .prediction-toggle {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .prediction-toggle.expanded {
            transform: rotate(180deg);
        }

        .prediction-content {
            padding: 20px;
            display: none;
        }

        .prediction-content.expanded {
            display: block;
        }

        .prediction-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .prediction-item:last-child {
            margin-bottom: 0;
        }

        .prediction-icon {
            margin-right: 10px;
            font-size: 1.1rem;
            width: 20px;
            text-align: center;
        }

        .confidence-high {
            color: #10b981;
            font-weight: 600;
        }

        .confidence-medium {
            color: #f59e0b;
            font-weight: 600;
        }

        .confidence-low {
            color: #ef4444;
            font-weight: 600;
        }

        .plateau-detected {
            color: #f59e0b;
            font-weight: 600;
        }

        .plateau-none {
            color: #10b981;
            font-weight: 600;
        }

        .data-quality-good {
            color: #10b981;
            font-weight: 600;
        }

        .data-quality-fair {
            color: #f59e0b;
            font-weight: 600;
        }

        .data-quality-poor {
            color: #ef4444;
            font-weight: 600;
        }

        /* ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³æœ€é©åŒ– */
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }

            .container {
                margin: 0;
                border-radius: 10px;
            }

            .header {
                padding: 15px;
            }

            .header h1 {
                font-size: 1.8rem;
            }

            .tabs {
                flex-direction: row;
            }

            .tab {
                padding: 10px 5px;
                font-size: 1.2rem;
                min-height: 50px;
            }

            .tab .desktop-text {
                display: none;
            }

            .tab .mobile-text {
                display: inline;
                font-size: 1.5rem;
            }

            .tab-content {
                padding: 15px;
            }

            .form-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .form-section {
                padding: 15px;
                margin-bottom: 15px;
            }

            .form-section h3 {
                font-size: 1.1rem;
                margin-bottom: 15px;
            }

            .form-group label {
                font-size: 0.9rem;
                margin-bottom: 6px;
            }

            .form-group input,
            .form-group select {
                padding: 10px;
                font-size: 16px;
                min-height: 44px;
            }

            .form-group input[type="number"] {
                max-width: 150px;
            }

            .form-group input[type="date"] {
                max-width: 200px;
            }

            .form-group select {
                max-width: 200px;
            }

            .button-group {
                flex-direction: column;
                gap: 8px;
            }

            .btn {
                padding: 12px 20px;
                font-size: 0.95rem;
                margin-right: 0;
                width: 100%;
                min-height: 48px;
            }

            .btn-small {
                padding: 8px 12px;
                font-size: 0.8rem;
                min-height: 40px;
                width: auto;
                margin: 2px;
            }

            .table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                margin: 0 -15px;
                border-radius: 0;
            }

            .data-table {
                min-width: 900px;
                font-size: 0.8rem;
                border-radius: 0;
            }

            .data-table th,
            .data-table td {
                padding: 8px 6px;
                min-width: 80px;
                font-size: 0.75rem;
            }

            .data-table th:last-child,
            .data-table td:last-child {
                min-width: 140px;
            }

            .mobile-header {
                display: table-row;
            }

            .desktop-header {
                display: none;
            }

            .chart-container {
                padding: 15px;
                margin: 0 -15px 15px -15px;
                border-radius: 0;
            }

            .chart-container h3 {
                font-size: 1rem;
                margin-bottom: 15px;
                line-height: 1.3;
            }

            .chart-wrapper {
                height: 500px;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                padding: 5px;
            }

            .goal-section {
                padding: 15px;
                margin-bottom: 20px;
            }

            .goal-input-form {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }

            .goal-input-form input {
                width: 100%;
                max-width: 200px;
                margin: 0 auto;
            }

            .goal-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .goal-stat-value {
                font-size: 1.2rem;
            }

            .goal-stat-label {
                font-size: 0.8rem;
            }

            .clear-achievement {
                font-size: 1.5rem;
            }

            .prediction-details {
                margin: 15px -15px 0 -15px;
                border-radius: 0;
                border-left: none;
                border-right: none;
            }

            .prediction-header {
                padding: 12px 15px;
            }

            .prediction-header h4 {
                font-size: 1rem;
            }

            .prediction-content {
                padding: 15px;
            }

            .prediction-item {
                font-size: 0.9rem;
                margin-bottom: 10px;
            }

            .export-section {
                padding: 15px;
                margin-top: 15px;
            }

            .export-section h3 {
                font-size: 1.1rem;
                margin-bottom: 10px;
            }

            .export-section p {
                font-size: 0.9rem;
                line-height: 1.4;
            }

            .table-container::-webkit-scrollbar,
            .chart-wrapper::-webkit-scrollbar {
                height: 8px;
                background: #f1f5f9;
            }

            .table-container::-webkit-scrollbar-thumb,
            .chart-wrapper::-webkit-scrollbar-thumb {
                background: #3b82f6;
                border-radius: 4px;
                border: 1px solid #f1f5f9;
            }
        }

        @media (max-width: 320px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .tab {
                padding: 8px 3px;
                font-size: 1rem;
            }

            .tab .mobile-text {
                font-size: 1.3rem;
            }

            .form-section {
                padding: 12px;
            }

            .chart-wrapper {
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ’ª ä¿ºã®å¤§ä¼šã¾ã§ã®é“ã®ã‚Š</h1>
            <p>Ver1.37 [äºˆæ¸¬è©³ç´°åˆ†ææ©Ÿèƒ½ - ãƒ—ãƒ©ãƒˆãƒ¼æ¤œå‡ºãƒ»å¤–ã‚Œå€¤é™¤å»ãƒ»ä¿¡é ¼åº¦è¡¨ç¤º]</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('daily')">
                <span class="desktop-text">æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿ç®¡ç†</span>
                <span class="mobile-text">âš–ï¸</span>
            </button>
            <button class="tab" onclick="showTab('training')">
                <span class="desktop-text">ç­‹åŠ›ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ç®¡ç†</span>
                <span class="mobile-text">ğŸ‹ï¸</span>
            </button>
            <button class="tab" onclick="showTab('analysis')">
                <span class="desktop-text">ãƒ‡ãƒ¼ã‚¿åˆ†æãƒ»ã‚°ãƒ©ãƒ•</span>
                <span class="mobile-text">ğŸ“ˆ</span>
            </button>
            <button class="tab" onclick="showTab('export')">
                <span class="desktop-text">ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</span>
                <span class="mobile-text">ğŸ“¤</span>
            </button>
        </div>

        <div id="status-message"></div>
<!-- æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚¿ãƒ– -->
        <div id="daily" class="tab-content active">
            <!-- ç›®æ¨™è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="goal-section" id="goal-section">
                <div id="goal-input" class="goal-input-form">
                    <h3>ğŸ¯ ç›®æ¨™ä½“é‡ã‚’è¨­å®šã—ã¦ãã ã•ã„</h3>
                    <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap; justify-content: center;">
                        <input type="number" id="target-weight" min="40" max="100" step="0.1" placeholder="65.0">
                        <span style="font-weight: 600;">kg</span>
                        <button type="button" class="btn-goal" onclick="setGoal()">è¨­å®šã™ã‚‹</button>
                    </div>
                </div>
                
                <div id="goal-display" class="goal-display">
                    <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 15px;">
                        <h3 id="goal-title">ğŸ¯ ç›®æ¨™: --kg</h3>
                        <button type="button" class="btn-goal" onclick="resetGoal()" style="margin-left: auto;">å†è¨­å®š</button>
                    </div>
                    
                    <div class="goal-stats">
                        <div class="goal-stat">
                            <div class="goal-stat-value" id="remaining-days">--</div>
                            <div class="goal-stat-label">æ®‹ã‚Šæ—¥æ•°</div>
                        </div>
                        <div class="goal-stat">
                            <div class="goal-stat-value" id="remaining-weight">--</div>
                            <div class="goal-stat-label">æ®‹ã‚Šæ¸›é‡</div>
                        </div>
                        <div class="goal-stat">
                            <div class="goal-stat-value" id="current-weight-display">--</div>
                            <div class="goal-stat-label">ç¾åœ¨ä½“é‡</div>
                        </div>
                        <div class="goal-stat">
                            <div class="goal-stat-value" id="daily-target">--</div>
                            <div class="goal-stat-label">1æ—¥ç›®æ¨™</div>
                        </div>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-item">
                            <div class="progress-label">
                                <span>ğŸ“… æ—¥æ•°é€²æ—</span>
                                <span id="days-progress-text">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill progress-days" id="days-progress-bar" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <div class="progress-item">
                            <div class="progress-label">
                                <span id="weight-progress-label">âš–ï¸ æ¸›é‡é€²æ—</span>
                                <span id="weight-progress-text">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill progress-weight" id="weight-progress-bar" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <div id="clear-achievement" class="clear-achievement" style="display: none;">
                            ğŸ‰ Clearï¼ ğŸ‰
                        </div>
                    </div>

                    <!-- äºˆæ¸¬è©³ç´°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                    <div class="prediction-details" id="prediction-details">
                        <div class="prediction-header" onclick="togglePredictionDetails()">
                            <h4>ğŸ“Š äºˆæ¸¬è©³ç´°</h4>
                            <span class="prediction-toggle" id="prediction-toggle">ğŸ”½</span>
                        </div>
                        <div class="prediction-content" id="prediction-content">
                            <div class="prediction-item">
                                <span class="prediction-icon">ğŸ¯</span>
                                <span>ç²¾å¯†ä½“é‡äºˆæ¸¬: <span id="detailed-prediction">--kg</span> (ä¿¡é ¼åº¦: <span id="confidence-level">--</span>)</span>
                            </div>
                            <div class="prediction-item">
                                <span class="prediction-icon">âš ï¸</span>
                                <span>ãƒ—ãƒ©ãƒˆãƒ¼æ¤œå‡º: <span id="plateau-status">--</span></span>
                            </div>
                            <div class="prediction-item">
                                <span class="prediction-icon">ğŸ“Š</span>
                                <span>ãƒ‡ãƒ¼ã‚¿å“è³ª: <span id="data-quality">--</span></span>
                            </div>
                            <div class="prediction-item">
                                <span class="prediction-icon">ğŸ‹ï¸</span>
                                <span>ç­‹ãƒˆãƒ¬åŠ¹æœ: <span id="training-effect">--</span></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>ğŸ“Š æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿å…¥åŠ›</h3>
                <form id="daily-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="daily-date">å¹´æœˆæ—¥</label>
                            <input type="date" id="daily-date" required>
                        </div>
                        <div class="form-group">
                            <label for="weight">ä½“é‡ (kg)</label>
                            <input type="number" id="weight" step="0.1" min="40" max="150" required placeholder="ä¾‹: 70.5">
                        </div>
                        <div class="form-group">
                            <label for="calories">æ‘‚å–ã‚«ãƒ­ãƒªãƒ¼ (kcal)</label>
                            <input type="number" id="calories" min="800" max="5000" required placeholder="ä¾‹: 2000">
                        </div>
                        <div class="form-group">
                            <label for="steps">æ­©æ•°</label>
                            <input type="number" id="steps" min="0" max="50000" required placeholder="ä¾‹: 8000">
                        </div>
                        <div class="form-group">
                            <label for="event">ã‚¤ãƒ™ãƒ³ãƒˆ</label>
                            <input type="text" id="event" maxlength="50" placeholder="ä¾‹: ä¼šé£Ÿã€ä½“èª¿ä¸è‰¯ã€ãƒãƒ¼ãƒˆãƒ‡ã‚¤">
                        </div>
                    </div>
                    <div class="button-group">
                        <button type="submit" class="btn">ãƒ‡ãƒ¼ã‚¿ä¿å­˜</button>
                        <button type="button" class="btn btn-secondary" onclick="clearDailyForm()">ã‚¯ãƒªã‚¢</button>
                    </div>
                </form>
            </div>

            <div class="form-section">
                <h3>ğŸ“ˆ æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿ä¸€è¦§</h3>
                <div class="table-container">
                    <table class="data-table" id="daily-table">
                        <thead>
                            <tr class="desktop-header">
                                <th>æ—¥ä»˜</th>
                                <th>ä½“é‡ (kg)</th>
                                <th>å‰æ—¥æ¯”</th>
                                <th>æ‘‚å–ã‚«ãƒ­ãƒªãƒ¼ (kcal)</th>
                                <th>æ­©æ•°</th>
                                <th>æ­©è¡Œæ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼</th>
                                <th>ç­‹ãƒˆãƒ¬æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼</th>
                                <th>ã‚¤ãƒ™ãƒ³ãƒˆ</th>
                                <th>æ“ä½œ</th>
                            </tr>
                            <tr class="mobile-header">
                                <th>ğŸ“…</th>
                                <th>âš–ï¸</th>
                                <th>ğŸ§®</th>
                                <th>ğŸš</th>
                                <th>ğŸš¶</th>
                                <th>ğŸš¶</th>
                                <th>ğŸ‹ï¸</th>
                                <th>ğŸ“</th>
                                <th>âŒ</th>
                            </tr>
                        </thead>
                        <tbody id="daily-table-body">
                            <!-- ãƒ‡ãƒ¼ã‚¿ãŒå‹•çš„ã«æŒ¿å…¥ã•ã‚Œã¾ã™ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ç­‹åŠ›ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ç®¡ç†ã‚¿ãƒ– -->
        <div id="training" class="tab-content">
            <div class="form-section">
                <h3>ğŸ‹ï¸ ç­‹åŠ›ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²</h3>
                <form id="training-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="training-date">å¹´æœˆæ—¥</label>
                            <input type="date" id="training-date" required>
                        </div>
                        <div class="form-group">
                            <label for="exercise">ç¨®ç›®</label>
                            <select id="exercise" required>
                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                <option value="ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹">ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹</option>
                                <option value="ãƒšãƒƒã‚¯ãƒ•ãƒ©ã‚¤">ãƒšãƒƒã‚¯ãƒ•ãƒ©ã‚¤</option>
                                <option value="ãƒ‡ã‚£ãƒƒãƒ—ã‚¹">ãƒ‡ã‚£ãƒƒãƒ—ã‚¹</option>
                                <option value="ãƒ‡ã‚¯ãƒ©ã‚¤ãƒ³ãƒ—ãƒ¬ã‚¹">ãƒ‡ã‚¯ãƒ©ã‚¤ãƒ³ãƒ—ãƒ¬ã‚¹</option>
                                <option value="ãƒ©ãƒƒãƒˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³">ãƒ©ãƒƒãƒˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³</option>
                                <option value="DYãƒ­ãƒ¼ã‚¤ãƒ³ã‚°">DYãƒ­ãƒ¼ã‚¤ãƒ³ã‚°</option>
                                <option value="Tãƒãƒ¼ãƒ­ãƒ¼ã‚¤ãƒ³ã‚°">Tãƒãƒ¼ãƒ­ãƒ¼ã‚¤ãƒ³ã‚°</option>
                                <option value="ãƒãƒ³ãƒ‹ãƒ³ã‚°">ãƒãƒ³ãƒ‹ãƒ³ã‚°</option>
                                <option value="ãƒã‚·ãƒ³ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹">ãƒã‚·ãƒ³ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹</option>
                                <option value="ãƒ€ãƒ³ãƒ™ãƒ«ã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚º">ãƒ€ãƒ³ãƒ™ãƒ«ã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚º</option>
                                <option value="ãƒ€ãƒ³ãƒ™ãƒ«ãƒªã‚¢ãƒ¬ã‚¤ã‚º">ãƒ€ãƒ³ãƒ™ãƒ«ãƒªã‚¢ãƒ¬ã‚¤ã‚º</option>
                                <option value="ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ãƒ³ãƒ€ãƒ³ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«">ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ãƒ³ãƒ€ãƒ³ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«</option>
                                <option value="ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ">ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ</option>
                                <option value="ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ">ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ</option>
                                <option value="ãƒãƒƒã‚¯ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ">ãƒãƒƒã‚¯ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ</option>
                                <option value="45åº¦ãƒ¬ãƒƒã‚°ãƒ—ãƒ¬ã‚¹">45åº¦ãƒ¬ãƒƒã‚°ãƒ—ãƒ¬ã‚¹</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="training-weight">é‡é‡ (kg)</label>
                            <input type="number" id="training-weight" step="0.5" min="1" max="300" required placeholder="ä¾‹: 80.0">
                        </div>
                        <div class="form-group">
                            <label for="reps">å›æ•°</label>
                            <select id="reps" required>
                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                                <option value="13">13</option>
                                <option value="14">14</option>
                                <option value="15">15</option>
                                <option value="16">16</option>
                                <option value="17">17</option>
                                <option value="18">18</option>
                                <option value="19">19</option>
                                <option value="20">20</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="sets">ã‚»ãƒƒãƒˆæ•°</label>
                            <select id="sets" required>
                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                                <option value="13">13</option>
                                <option value="14">14</option>
                                <option value="15">15</option>
                                <option value="16">16</option>
                                <option value="17">17</option>
                                <option value="18">18</option>
                                <option value="19">19</option>
                                <option value="20">20</option>
                            </select>
                        </div>
                    </div>
                    <div class="button-group">
                        <button type="submit" class="btn">ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²ä¿å­˜</button>
                        <button type="button" class="btn btn-secondary" onclick="clearTrainingForm()">ã‚¯ãƒªã‚¢</button>
                    </div>
                </form>
            </div>

            <div class="form-section">
                <h3>ğŸ“‹ ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²ä¸€è¦§</h3>
                <div class="table-container">
                    <table class="data-table" id="training-table">
                        <thead>
                            <tr class="desktop-header">
                                <th>æ—¥ä»˜</th>
                                <th>ç¨®ç›®</th>
                                <th>é‡é‡ (kg)</th>
                                <th>å›æ•°</th>
                                <th>ã‚»ãƒƒãƒˆæ•°</th>
                                <th>éƒ¨ä½</th>
                                <th>å¼·åº¦</th>
                                <th>æ“ä½œ</th>
                            </tr>
                            <tr class="mobile-header">
                                <th>ğŸ“…</th>
                                <th>ğŸ‹ï¸</th>
                                <th>âš–ï¸</th>
                                <th>ğŸ”¢</th>
                                <th>ğŸ”¢</th>
                                <th>ğŸ’ª</th>
                                <th>ğŸ”¥</th>
                                <th>âŒ</th>
                            </tr>
                        </thead>
                        <tbody id="training-table-body">
                            <!-- ãƒ‡ãƒ¼ã‚¿ãŒå‹•çš„ã«æŒ¿å…¥ã•ã‚Œã¾ã™ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ãƒ‡ãƒ¼ã‚¿åˆ†æãƒ»ã‚°ãƒ©ãƒ•ã‚¿ãƒ– -->
        <div id="analysis" class="tab-content">
            <div class="chart-container">
                <h3 id="chart-title">å¤§ä¼šå½“æ—¥ã¯è¨ˆç®—ä¸­...ã§ç€åœ°è¦‹è¾¼ã¿ï¼</h3>
                <div class="chart-wrapper">
                    <canvas id="analysisChart"></canvas>
                </div>
            </div>
        </div>

        <!-- ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¿ãƒ– -->
        <div id="export" class="tab-content">
            <div class="export-section">
                <h3>ğŸ“¤ ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</h3>
                <p>ãƒ‡ãƒ¼ã‚¿ã‚’CSVå½¢å¼ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¦ã€Excelã§é–‹ãã“ã¨ãŒã§ãã¾ã™ã€‚</p>
                <div class="button-group">
                    <button class="btn" onclick="exportDailyData()">æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                    <button class="btn" onclick="exportTrainingData()">ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                    <button class="btn" onclick="exportAllData()">å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                </div>
            </div>
        </div>
    </div>
<script>
        // API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆãƒ‡ãƒ¢ç”¨ãªã®ã§ãƒ€ãƒŸãƒ¼é–¢æ•°ã§ä»£æ›¿ï¼‰
        const API_BASE = '/.netlify/functions';

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let dailyData = [];
        let trainingData = [];
        let analysisChart = null;
        let targetGoal = null;
        let predictionAnalysis = null;
        
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼åŸºæœ¬æƒ…å ±ï¼ˆå›ºå®šå€¤ï¼‰
        const USER_PROFILE = {
            age: 38,
            height: 176, // cm
            gender: 'male'
        };

        // æ—¥æœ¬ã®ç¥æ—¥ãƒ‡ãƒ¼ã‚¿ (2025å¹´)
        const holidays2025 = [
            '2025-01-01', '2025-01-13', '2025-02-11', '2025-02-23', '2025-03-20',
            '2025-04-29', '2025-05-03', '2025-05-04', '2025-05-05', '2025-07-21',
            '2025-08-11', '2025-09-15', '2025-09-23', '2025-10-13', '2025-11-03',
            '2025-11-23', '2025-12-23'
        ];

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
            loadGoalData();
            setupDateDefaults();
            setupEventListeners();
            setupInputValidation();
        });

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
        function setupEventListeners() {
            document.getElementById('daily-form').addEventListener('submit', handleDailySubmit);
            document.getElementById('training-form').addEventListener('submit', handleTrainingSubmit);
        }

        // å…¥åŠ›å€¤æ¤œè¨¼ã®è¨­å®š
        function setupInputValidation() {
            const weightInput = document.getElementById('weight');
            weightInput.addEventListener('blur', function() {
                const value = parseFloat(this.value);
                if (value && value < 40) this.value = 40;
                if (value && value > 150) this.value = 150;
            });

            const caloriesInput = document.getElementById('calories');
            caloriesInput.addEventListener('blur', function() {
                const value = parseInt(this.value);
                if (value && value < 800) this.value = 800;
                if (value && value > 5000) this.value = 5000;
            });

            const stepsInput = document.getElementById('steps');
            stepsInput.addEventListener('blur', function() {
                const value = parseInt(this.value);
                if (value && value < 0) this.value = 0;
                if (value && value > 50000) this.value = 50000;
            });

            const trainingWeightInput = document.getElementById('training-weight');
            trainingWeightInput.addEventListener('blur', function() {
                const value = parseFloat(this.value);
                if (value && value < 1) this.value = 1;
                if (value && value > 300) this.value = 300;
            });
        }

        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ—¥ä»˜ã®è¨­å®š
        function setupDateDefaults() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('daily-date').value = today;
            document.getElementById('training-date').value = today;
        }

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function showTab(tabName) {
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));

            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'analysis') {
                setTimeout(() => drawAnalysisChart(), 100);
            }
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
        function showStatus(message, type = 'success') {
            const statusEl = document.getElementById('status-message');
            statusEl.innerHTML = `<div class="status-message status-${type}">${message}</div>`;
            setTimeout(() => {
                statusEl.innerHTML = '';
            }, 3000);
        }

        // äºˆæ¸¬è©³ç´°è¡¨ç¤ºã®åˆ‡ã‚Šæ›¿ãˆ
        function togglePredictionDetails() {
            const content = document.getElementById('prediction-content');
            const toggle = document.getElementById('prediction-toggle');
            
            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                toggle.classList.remove('expanded');
                toggle.textContent = 'ğŸ”½';
            } else {
                content.classList.add('expanded');
                toggle.classList.add('expanded');
                toggle.textContent = 'ğŸ”¼';
            }
        }

        // ãƒ—ãƒ©ãƒˆãƒ¼æ¤œå‡ºæ©Ÿèƒ½ï¼ˆç·šå½¢å›å¸°ï¼‰
        function detectPlateau(weightData) {
            if (weightData.length < 14) return { isPlateau: false, slope: 0 };
            
            const recentData = weightData.slice(-14);
            const n = recentData.length;
            
            let sumX = 0, sumY = 0, sumXY = 0, sumX2 = 0;
            
            recentData.forEach((item, index) => {
                const x = index + 1;
                const y = item.weight;
                sumX += x;
                sumY += y;
                sumXY += x * y;
                sumX2 += x * x;
            });
            
            const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
            const plateauThreshold = 0.02;
            
            return {
                isPlateau: Math.abs(slope) < plateauThreshold,
                slope: slope
            };
        }

        // å¤–ã‚Œå€¤é™¤å»æ©Ÿèƒ½ï¼ˆå››åˆ†ä½ç¯„å›²æ³•ï¼‰
        function removeOutliers(data) {
            const excludeEvents = ['ãƒãƒ¼ãƒˆãƒ‡ã‚¤', 'ä¼šé£Ÿ', 'é£²ã¿ä¼š'];
            
            const eventFiltered = data.filter(item => 
                !item.event || !excludeEvents.some(event => 
                    item.event.includes(event)
                )
            );
            
            if (eventFiltered.length < 4) return { cleaned: data, removed: 0 };
            
            const calories = eventFiltered.map(item => item.calories).sort((a, b) => a - b);
            const q1Index = Math.floor(calories.length * 0.25);
            const q3Index = Math.floor(calories.length * 0.75);
            const q1 = calories[q1Index];
            const q3 = calories[q3Index];
            const iqr = q3 - q1;
            const lowerBound = q1 - 1.5 * iqr;
            const upperBound = q3 + 1.5 * iqr;
            
            const cleaned = eventFiltered.filter(item => 
                item.calories >= lowerBound && item.calories <= upperBound
            );
            
            return {
                cleaned: cleaned,
                removed: data.length - cleaned.length
            };
        }

        // è©³ç´°ç­‹ãƒˆãƒ¬åŠ¹æœåˆ†æ
        function analyzeTrainingEffect(trainingData, currentDate) {
            if (trainingData.length === 0) return { totalBoost: 0, details: '' };
            
            const fourWeeksAgo = new Date(currentDate);
            fourWeeksAgo.setDate(fourWeeksAgo.getDate() - 28);
            
            const recentTraining = trainingData.filter(t => {
                const trainingDate = new Date(t.date);
                return trainingDate >= fourWeeksAgo && trainingDate <= currentDate;
            });
            
            const weeklyFrequency = recentTraining.length / 4;
            const baseBoost = weeklyFrequency * 15;
            
            const bodyParts = {};
            recentTraining.forEach(t => {
                const part = t.bodyPart || getBodyPart(t.exercise);
                bodyParts[part] = (bodyParts[part] || 0) + 1;
            });
            
            const partCounts = Object.values(bodyParts);
            const maxPart = Math.max(...partCounts, 0);
            const minPart = Math.min(...partCounts, maxPart);
            const balancePercent = maxPart > 0 ? ((maxPart - minPart) / maxPart) * 100 : 0;
            const balanceBonus = balancePercent <= 30 ? 1.2 : 1.0;
            
            const consistencyScore = Math.min(weeklyFrequency / 3, 1.0);
            const consistencyBonus = consistencyScore > 0.8 ? 1.15 : 1.0;
            
            const finalBoost = baseBoost * balanceBonus * consistencyBonus;
            
            return {
                totalBoost: Math.round(finalBoost),
                details: `é€±${weeklyFrequency.toFixed(1)}å›ãƒ»ãƒãƒ©ãƒ³ã‚¹${balanceBonus > 1 ? 'è‰¯' : 'è¦æ”¹å–„'}`
            };
        }

        // çµ±åˆäºˆæ¸¬ã‚·ã‚¹ãƒ†ãƒ 
        function calculateAdvancedPrediction(dailyData, trainingData) {
            if (dailyData.length === 0) {
                return {
                    predictedWeight: null,
                    confidence: 'low',
                    plateauStatus: 'ãƒ‡ãƒ¼ã‚¿ä¸è¶³',
                    dataQuality: 'ãƒ‡ãƒ¼ã‚¿ä¸è¶³',
                    trainingEffect: 'ãƒ‡ãƒ¼ã‚¿ä¸è¶³'
                };
            }
            
            const outlierResult = removeOutliers(dailyData);
            const cleanedData = outlierResult.cleaned;
            const plateauResult = detectPlateau(cleanedData);
            const basicPrediction = calculatePreciseWeightPrediction(cleanedData);
            let predictedWeight = basicPrediction.predictedWeight;
            
            if (plateauResult.isPlateau && predictedWeight) {
                predictedWeight += 0.5;
            }
            
            let confidence = 'high';
            if (plateauResult.isPlateau) confidence = 'low';
            else if (outlierResult.removed > cleanedData.length * 0.2) confidence = 'medium';
            else if (cleanedData.length < 7) confidence = 'medium';
            
            let dataQuality = 'good';
            if (outlierResult.removed > cleanedData.length * 0.3) dataQuality = 'poor';
            else if (outlierResult.removed > cleanedData.length * 0.1) dataQuality = 'fair';
            
            const today = new Date();
            const trainingAnalysis = analyzeTrainingEffect(trainingData, today);
            
            return {
                predictedWeight: predictedWeight,
                confidence: confidence,
                plateauStatus: plateauResult.isPlateau ? 'ãƒ—ãƒ©ãƒˆãƒ¼æ¤œå‡º' : 'ãªã—',
                dataQuality: dataQuality + ` (å¤–ã‚Œå€¤${outlierResult.removed}ä»¶é™¤å¤–)`,
                trainingEffect: `+${trainingAnalysis.totalBoost}kcal/æ—¥ (${trainingAnalysis.details})`
            };
        }

        // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        async function loadAllData() {
            try {
                showStatus('ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...', 'success');
                
                const dailyResponse = await fetch(`${API_BASE}/get-daily-data`);
                if (dailyResponse.ok) {
                    dailyData = await dailyResponse.json();
                }

                const trainingResponse = await fetch(`${API_BASE}/get-training-data`);
                if (trainingResponse.ok) {
                    trainingData = await trainingResponse.json();
                }

                updateDailyTable();
                updateTrainingTable();
                updateGoalProgress();
                showStatus('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ãŒå®Œäº†ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                showStatus('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        // ç›®æ¨™ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        async function loadGoalData() {
            try {
                const response = await fetch(`${API_BASE}/get-goal-data`);
                if (response.ok) {
                    targetGoal = await response.json();
                    if (targetGoal) {
                        showGoalDisplay();
                        updateGoalProgress();
                    }
                }
            } catch (error) {
                console.error('ç›®æ¨™ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        // ç›®æ¨™è¨­å®š
        async function setGoal() {
            const targetWeight = parseFloat(document.getElementById('target-weight').value);
            
            if (!targetWeight || targetWeight < 40 || targetWeight > 100) {
                showStatus('ç›®æ¨™ä½“é‡ã¯40kgã€œ100kgã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }

            let latestWeight = null;
            if (dailyData.length > 0) {
                const sortedData = [...dailyData].sort((a, b) => new Date(b.date) - new Date(a.date));
                latestWeight = sortedData[0].weight;
            }

            if (!latestWeight) {
                showStatus('ã¾ãšä½“é‡ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }

            const goalData = {
                targetWeight: targetWeight,
                setDate: new Date().toISOString().split('T')[0],
                startWeight: latestWeight
            };

            try {
                const response = await fetch(`${API_BASE}/save-goal-data`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(goalData)
                });

                if (response.ok) {
                    targetGoal = goalData;
                    showGoalDisplay();
                    updateGoalProgress();
                    showStatus('ç›®æ¨™ã‚’è¨­å®šã—ã¾ã—ãŸï¼');
                } else {
                    throw new Error('ç›®æ¨™è¨­å®šã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                console.error('ç›®æ¨™è¨­å®šã‚¨ãƒ©ãƒ¼:', error);
                showStatus('ç›®æ¨™è¨­å®šã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        // ç›®æ¨™å†è¨­å®š
        async function resetGoal() {
            if (confirm('ç›®æ¨™ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                try {
                    const response = await fetch(`${API_BASE}/delete-goal-data`, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    });

                    if (response.ok) {
                        document.getElementById('goal-input').style.display = 'block';
                        document.getElementById('goal-display').classList.remove('active');
                        document.getElementById('target-weight').value = '';
                        targetGoal = null;
                        showStatus('ç›®æ¨™ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ');
                    } else {
                        throw new Error('ç›®æ¨™å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
                } catch (error) {
                    console.error('ç›®æ¨™å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
                    showStatus('ç›®æ¨™å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            }
        }

        // ç›®æ¨™è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        function showGoalDisplay() {
            document.getElementById('goal-input').style.display = 'none';
            document.getElementById('goal-display').classList.add('active');
        }
// ç›®æ¨™é€²æ—æ›´æ–°
        function updateGoalProgress() {
            if (!targetGoal || dailyData.length === 0) return;

            const sortedData = [...dailyData].sort((a, b) => new Date(b.date) - new Date(a.date));
            const currentWeight = sortedData[0].weight;
            
            const today = new Date();
            const targetDate = new Date('2025-10-18');
            const startDate = new Date(targetGoal.setDate);
            const totalDays = Math.ceil((targetDate - startDate) / (1000 * 60 * 60 * 24));
            const elapsedDays = Math.ceil((today - startDate) / (1000 * 60 * 60 * 24));
            const remainingDays = Math.max(0, Math.ceil((targetDate - today) / (1000 * 60 * 60 * 24)));
            
            const totalWeightToLose = targetGoal.startWeight - targetGoal.targetWeight;
            const currentWeightLoss = targetGoal.startWeight - currentWeight;
            const remainingWeight = currentWeight - targetGoal.targetWeight;
            const dailyTarget = remainingWeight > 0 ? (remainingWeight / Math.max(1, remainingDays)).toFixed(3) : 0;
            
            const daysProgress = Math.min(100, Math.max(0, (elapsedDays / totalDays) * 100));
            const weightProgress = totalWeightToLose > 0 ? Math.max(0, (currentWeightLoss / totalWeightToLose) * 100) : 0;
            const isCompleted = currentWeight <= targetGoal.targetWeight;

            document.getElementById('goal-title').textContent = `ğŸ¯ ç›®æ¨™: ${targetGoal.targetWeight}kg`;
            document.getElementById('remaining-days').textContent = `${remainingDays}æ—¥`;
            document.getElementById('remaining-weight').textContent = isCompleted ? 'é”æˆï¼' : `${remainingWeight.toFixed(1)}kg`;
            document.getElementById('current-weight-display').textContent = `${currentWeight}kg`;
            document.getElementById('daily-target').textContent = isCompleted ? 'é”æˆï¼' : `${dailyTarget}kg/æ—¥`;
            
            document.getElementById('days-progress-text').textContent = `${Math.round(daysProgress)}%`;
            document.getElementById('days-progress-bar').style.width = `${daysProgress}%`;
            
            if (isCompleted) {
                document.getElementById('weight-progress-label').textContent = 'ğŸ‰ æ¸›é‡é”æˆ';
                document.getElementById('weight-progress-text').textContent = 'Clearï¼';
                document.getElementById('weight-progress-bar').classList.add('completed');
                document.getElementById('weight-progress-bar').style.width = '100%';
                document.getElementById('clear-achievement').style.display = 'block';
            } else {
                document.getElementById('weight-progress-label').textContent = 'âš–ï¸ æ¸›é‡é€²æ—';
                document.getElementById('weight-progress-text').textContent = `${Math.round(weightProgress)}%`;
                document.getElementById('weight-progress-bar').classList.remove('completed');
                document.getElementById('weight-progress-bar').style.width = `${Math.min(100, weightProgress)}%`;
                document.getElementById('clear-achievement').style.display = 'none';
            }

            updatePredictionDetails();
        }

        // äºˆæ¸¬è©³ç´°æ›´æ–°
        function updatePredictionDetails() {
            predictionAnalysis = calculateAdvancedPrediction(dailyData, trainingData);
            
            const predictionEl = document.getElementById('detailed-prediction');
            const confidenceEl = document.getElementById('confidence-level');
            
            if (predictionAnalysis.predictedWeight) {
                predictionEl.textContent = `${predictionAnalysis.predictedWeight.toFixed(1)}kg`;
            } else {
                predictionEl.textContent = '--kg';
            }
            
            confidenceEl.textContent = predictionAnalysis.confidence;
            confidenceEl.className = `confidence-${predictionAnalysis.confidence}`;
            
            const plateauEl = document.getElementById('plateau-status');
            plateauEl.textContent = predictionAnalysis.plateauStatus;
            plateauEl.className = predictionAnalysis.plateauStatus === 'ãªã—' ? 'plateau-none' : 'plateau-detected';
            
            const qualityEl = document.getElementById('data-quality');
            qualityEl.textContent = predictionAnalysis.dataQuality;
            const qualityClass = predictionAnalysis.dataQuality.includes('good') ? 'good' : 
                               predictionAnalysis.dataQuality.includes('fair') ? 'fair' : 'poor';
            qualityEl.className = `data-quality-${qualityClass}`;
            
            const trainingEl = document.getElementById('training-effect');
            trainingEl.textContent = predictionAnalysis.trainingEffect;
        }

        // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†
        async function handleDailySubmit(e) {
            e.preventDefault();
            
            const formData = {
                date: document.getElementById('daily-date').value,
                weight: parseFloat(document.getElementById('weight').value),
                calories: parseInt(document.getElementById('calories').value),
                steps: parseInt(document.getElementById('steps').value),
                event: document.getElementById('event').value
            };

            if (formData.weight < 40 || formData.weight > 150) {
                showStatus('ä½“é‡ã¯40kgã€œ150kgã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            if (formData.calories < 800 || formData.calories > 5000) {
                showStatus('æ‘‚å–ã‚«ãƒ­ãƒªãƒ¼ã¯800ã€œ5000kcalã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            if (formData.steps < 0 || formData.steps > 50000) {
                showStatus('æ­©æ•°ã¯0ã€œ50000æ­©ã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/save-daily-data`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    showStatus('æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
                    loadAllData();
                    updateGoalProgress();
                    clearDailyForm();
                } else {
                    throw new Error('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                console.error('ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
                showStatus('ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        async function handleTrainingSubmit(e) {
            e.preventDefault();
            
            const weight = parseFloat(document.getElementById('training-weight').value);
            const reps = parseInt(document.getElementById('reps').value);
            const sets = parseInt(document.getElementById('sets').value);
            const exercise = document.getElementById('exercise').value;

            if (weight < 1 || weight > 300) {
                showStatus('é‡é‡ã¯1kgã€œ300kgã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            const formData = {
                date: document.getElementById('training-date').value,
                exercise: exercise,
                weight: weight,
                reps: reps,
                sets: sets,
                bodyPart: getBodyPart(exercise),
                intensity: calculateIntensity(weight, reps, sets)
            };

            try {
                const response = await fetch(`${API_BASE}/save-training-data`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    showStatus('ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
                    loadAllData();
                    clearTrainingForm();
                } else {
                    throw new Error('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                console.error('ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
                showStatus('ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        function getBodyPart(exercise) {
            const bodyPartMap = {
                'ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹': 'èƒ¸', 'ãƒšãƒƒã‚¯ãƒ•ãƒ©ã‚¤': 'èƒ¸', 'ãƒ‡ã‚£ãƒƒãƒ—ã‚¹': 'èƒ¸', 'ãƒ‡ã‚¯ãƒ©ã‚¤ãƒ³ãƒ—ãƒ¬ã‚¹': 'èƒ¸',
                'ãƒ©ãƒƒãƒˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³': 'èƒŒä¸­', 'DYãƒ­ãƒ¼ã‚¤ãƒ³ã‚°': 'èƒŒä¸­', 'Tãƒãƒ¼ãƒ­ãƒ¼ã‚¤ãƒ³ã‚°': 'èƒŒä¸­', 'ãƒãƒ³ãƒ‹ãƒ³ã‚°': 'èƒŒä¸­', 'ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ': 'èƒŒä¸­',
                'ãƒã‚·ãƒ³ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹': 'è‚©', 'ãƒ€ãƒ³ãƒ™ãƒ«ã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚º': 'è‚©', 'ãƒ€ãƒ³ãƒ™ãƒ«ãƒªã‚¢ãƒ¬ã‚¤ã‚º': 'è‚©',
                'ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ãƒ³ãƒ€ãƒ³ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«': 'è…•',
                'ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ': 'è„š', 'ãƒãƒƒã‚¯ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ': 'è„š', '45åº¦ãƒ¬ãƒƒã‚°ãƒ—ãƒ¬ã‚¹': 'è„š'
            };
            return bodyPartMap[exercise] || 'ãã®ä»–';
        }

        function calculateIntensity(weight, reps, sets) {
            const totalVolume = weight * reps * sets;
            if (totalVolume >= 3000) return 'é«˜';
            if (totalVolume >= 1500) return 'ä¸­';
            return 'ä½';
        }

        function clearDailyForm() {
            document.getElementById('daily-form').reset();
            setupDateDefaults();
        }

        function clearTrainingForm() {
            document.getElementById('training-form').reset();
            setupDateDefaults();
        }

        function formatDateWithDay(dateStr) {
            const date = new Date(dateStr + 'T00:00:00');
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const dayNames = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
            const dayOfWeek = dayNames[date.getDay()];
            
            let className = '';
            if (date.getDay() === 6) {
                className = 'saturday';
            } else if (date.getDay() === 0 || holidays2025.includes(dateStr)) {
                className = 'sunday-holiday';
            }
            
            return {
                formatted: `${month}/${day}(${dayOfWeek})`,
                className: className
            };
        }

        function calculateWalkingCalories(steps) {
            return Math.round(steps * 0.04);
        }

        function calculateTrainingCalories(date) {
            const dayTraining = trainingData.filter(t => t.date === date);
            let totalCalories = 0;
            
            dayTraining.forEach(training => {
                const calories = calculatePreciseExerciseCalories(training.exercise, training.weight, training.reps, training.sets);
                totalCalories += calories;
            });
            
            return Math.round(totalCalories);
        }

        function getCurrentWeight() {
            if (dailyData.length === 0) return 70;
            const sortedData = [...dailyData].sort((a, b) => new Date(b.date) - new Date(a.date));
            return sortedData[0].weight;
        }

        function calculatePreciseExerciseCalories(exercise, weight, reps, sets) {
            const bodyWeight = getCurrentWeight();
            const METs = 6.0; // ç°¡ç•¥åŒ–
            const totalMinutes = (reps * sets * 4) / 60; // ç°¡ç•¥åŒ–
            return Math.round(METs * bodyWeight * totalMinutes * 1.05);
        }

        function calculatePreciseWeightPrediction(weightData) {
            if (weightData.length < 2) {
                return {
                    predictedWeight: weightData.length > 0 ? weightData[weightData.length - 1].weight : null,
                    currentWeight: weightData.length > 0 ? weightData[weightData.length - 1].weight : null
                };
            }

            const currentWeight = getCurrentWeight();
            const today = new Date();
            const targetDate = new Date('2025-10-18');
            const remainingDays = Math.max(0, Math.ceil((targetDate - today) / (1000 * 60 * 60 * 24)));
            
            if (remainingDays === 0) {
                return { predictedWeight: currentWeight, currentWeight: currentWeight };
            }
            
            // ç°¡ç•¥åŒ–ã•ã‚ŒãŸäºˆæ¸¬è¨ˆç®—
            const avgWeeklyLoss = 0.5; // kg
            const predictedWeightLoss = (avgWeeklyLoss / 7) * remainingDays;
            const predictedWeight = Math.max(40, currentWeight - predictedWeightLoss);
            
            return { predictedWeight: predictedWeight, currentWeight: currentWeight };
        }

        function updateDailyTable() {
            const tbody = document.getElementById('daily-table-body');
            tbody.innerHTML = '';
            // ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯ã¯ç°¡ç•¥åŒ–
        }

        function updateTrainingTable() {
            const tbody = document.getElementById('training-table-body');
            tbody.innerHTML = '';
            // ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯ã¯ç°¡ç•¥åŒ–
        }

        function drawAnalysisChart() {
            const ctx = document.getElementById('analysisChart').getContext('2d');
            // ã‚°ãƒ©ãƒ•æç”»ãƒ­ã‚¸ãƒƒã‚¯ã¯ç°¡ç•¥åŒ–
            ctx.fillText('ã‚°ãƒ©ãƒ•æ©Ÿèƒ½ã¯é–‹ç™ºä¸­ã§ã™', 200, 200);
        }

        // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½
        function exportDailyData() {
            const csvContent = 'date,weight,calories,steps\n';
            downloadCSV(csvContent, 'daily_data.csv');
        }

        function exportTrainingData() {
            const csvContent = 'date,exercise,weight,reps,sets\n';
            downloadCSV(csvContent, 'training_data.csv');
        }

        function exportAllData() {
            const csvContent = 'date,weight,calories,steps,training\n';
            downloadCSV(csvContent, 'all_data.csv');
        }

        function downloadCSV(content, filename) {
            const BOM = '\uFEFF';
            const blob = new Blob([BOM + content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showStatus(`${filename} ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ`);
        }

        // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºæ™‚ã®ã‚°ãƒ©ãƒ•å†æç”»
        let resizeTimeout;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(function() {
                if (analysisChart && document.getElementById('analysis').classList.contains('active')) {
                    drawAnalysisChart();
                }
            }, 300);
        });
    </script>
</body>
</html>    
