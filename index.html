<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿ºã®å¤§ä¼šã¾ã§ã®é“ã®ã‚Š</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ’ª</text></svg>">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .tab {
            flex: 1;
            padding: 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            color: #64748b;
            transition: all 0.3s ease;
            position: relative;
        }

        .tab.active {
            color: #4f46e5;
            background: white;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #4f46e5, #7c3aed);
        }

        .tab:hover:not(.active) {
            background: #f1f5f9;
            color: #475569;
        }

        .tab .desktop-text {
            display: inline;
        }

        .tab .mobile-text {
            display: none;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }

        .form-section h3 {
            color: #1e293b;
            margin-bottom: 20px;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .form-group input,
        .form-group select {
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4f46e5;
        }

        .btn {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(79, 70, 229, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
        }

        .btn-secondary:hover {
            box-shadow: 0 10px 20px rgba(107, 114, 128, 0.3);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .data-table thead,
        .data-table tbody {
            display: table;
            width: 100%;
            table-layout: fixed;
        }

        .data-table th,
        .data-table td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.9rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .data-table th {
            background: #f8fafc;
            font-weight: 600;
            color: #374151;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .data-table tr:hover {
            background: #f9fafb;
        }

        .weight-increase {
            color: #dc2626;
            font-weight: 600;
        }

        .weight-decrease {
            color: #2563eb;
            font-weight: 600;
        }

        .saturday {
            color: #0095d9;
            font-weight: 600;
        }

        .sunday-holiday {
            color: #d9333f;
            font-weight: 600;
        }

        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
            overflow: hidden;
        }

        .chart-container h3 {
            color: #1e293b;
            margin-bottom: 20px;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .chart-container canvas {
            max-width: 100%;
            height: auto !important;
        }

        /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ç”¨ã®ãƒãƒ£ãƒ¼ãƒˆã‚µã‚¤ã‚ºèª¿æ•´ */
        .chart-wrapper {
            position: relative;
            width: 100%;
            aspect-ratio: 4/3; /* 4:3ã®æ¯”ç‡ã‚’ç¶­æŒ */
            min-height: 400px;
        }

        /* ãƒ†ãƒ¼ãƒ–ãƒ«æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç”¨ã‚³ãƒ³ãƒ†ãƒŠ */
        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .status-success {
            background: #dcfce7;
            color: #16a34a;
            border: 1px solid #bbf7d0;
        }

        .status-error {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #6b7280;
        }

        .export-section {
            background: #f8fafc;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .mobile-header {
            display: none;
        }

        .desktop-header {
            display: table-row;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .tabs {
                flex-direction: row;
            }

            .tab {
                padding: 15px 5px;
                font-size: 1.5rem;
            }

            .tab .desktop-text {
                display: none;
            }

            .tab .mobile-text {
                display: inline;
            }

            .tab-content {
                padding: 15px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .form-section {
                padding: 20px;
                margin-bottom: 20px;
            }

            /* ãƒ¢ãƒã‚¤ãƒ«ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«è¨­å®š */
            .table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                margin: 0 -15px; /* ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°åˆ†ã‚’ç›¸æ®º */
                border-radius: 0;
            }

            .data-table {
                min-width: 900px; /* å¹…ã‚’åºƒã’ã¦ãƒœã‚¿ãƒ³ãŒè¦‹ãˆã‚‹ã‚ˆã†ã« */
                font-size: 0.8rem;
            }

            .data-table th,
            .data-table td {
                padding: 8px 6px;
                min-width: 90px; /* æœ€å°å¹…ã‚’åºƒã’ã‚‹ */
                font-size: 0.75rem;
            }

            /* æ“ä½œãƒœã‚¿ãƒ³ã®ã‚«ãƒ©ãƒ ã¯å°‘ã—åºƒã */
            .data-table th:last-child,
            .data-table td:last-child {
                min-width: 120px;
            }

            .mobile-header {
                display: table-row;
            }

            .desktop-header {
                display: none;
            }

            /* ãƒ¢ãƒã‚¤ãƒ«ç”¨ãƒãƒ£ãƒ¼ãƒˆè¨­å®š */
            .chart-container {
                padding: 15px;
                margin-bottom: 20px;
                margin: 0 -15px 20px -15px; /* ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°åˆ†ã‚’ç›¸æ®º */
                border-radius: 0;
            }

            .chart-wrapper {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                width: 100%;
                height: 50vh; /* ç”»é¢ã®é«˜ã•ã®50%ã‚’ä½¿ç”¨ */
                min-height: 350px; /* æœ€å°é«˜ã•ã‚’å¢—åŠ  */
                max-height: 500px; /* æœ€å¤§é«˜ã•ã‚’åˆ¶é™ */
                position: relative;
            }

            .chart-wrapper canvas {
                min-width: 1000px !important; /* æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç”¨ã®æœ€å°å¹…ã‚’å¢—åŠ  */
                height: 100% !important; /* ã‚³ãƒ³ãƒ†ãƒŠã®é«˜ã•ã«åˆã‚ã›ã‚‹ */
            }

            /* ã‚¹ãƒãƒ›å°‚ç”¨ã®é«˜è§£åƒåº¦å¯¾å¿œ */
            @media (max-width: 768px) {
                .chart-wrapper canvas {
                    image-rendering: -webkit-optimize-contrast; /* Webkitç³»ã§ã®é«˜å“è³ªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° */
                    image-rendering: crisp-edges; /* ã‚¨ãƒƒã‚¸ã‚’é®®æ˜ã« */
                    image-rendering: pixelated; /* ãƒ”ã‚¯ã‚»ãƒ«å˜ä½ã§ã®é®®æ˜åŒ– */
                }
            }

            .btn {
                padding: 6px 10px;
                font-size: 0.75rem;
                margin: 2px;
                white-space: nowrap;
            }

            /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° */
            .table-container::-webkit-scrollbar,
            .chart-wrapper::-webkit-scrollbar {
                height: 8px;
                background: #f1f5f9;
            }

            .table-container::-webkit-scrollbar-thumb,
            .chart-wrapper::-webkit-scrollbar-thumb {
                background: #3b82f6;
                border-radius: 4px;
                border: 1px solid #f1f5f9;
            }

            .table-container::-webkit-scrollbar-thumb:hover,
            .chart-wrapper::-webkit-scrollbar-thumb:hover {
                background: #2563eb;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ’ª ä¿ºã®å¤§ä¼šã¾ã§ã®é“ã®ã‚Š</h1>
            <p>Ver1.11 [ã‚¹ãƒãƒ›ãƒ»PCå®Œå…¨å‡ºã—åˆ†ã‘å¯¾å¿œãƒ»æœ€é©åŒ–]</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('daily')">
                <span class="desktop-text">æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿ç®¡ç†</span>
                <span class="mobile-text">âš–ï¸</span>
            </button>
            <button class="tab" onclick="showTab('training')">
                <span class="desktop-text">ç­‹åŠ›ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ç®¡ç†</span>
                <span class="mobile-text">ğŸ‹ï¸</span>
            </button>
            <button class="tab" onclick="showTab('analysis')">
                <span class="desktop-text">ãƒ‡ãƒ¼ã‚¿åˆ†æãƒ»ã‚°ãƒ©ãƒ•</span>
                <span class="mobile-text">ğŸ“ˆ</span>
            </button>
            <button class="tab" onclick="showTab('export')">
                <span class="desktop-text">ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</span>
                <span class="mobile-text">ğŸ“¤</span>
            </button>
        </div>

        <div id="status-message"></div>

        <!-- æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚¿ãƒ– -->
        <div id="daily" class="tab-content active">
            <div class="form-section">
                <h3>ğŸ“Š æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿å…¥åŠ›</h3>
                <form id="daily-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="daily-date">å¹´æœˆæ—¥</label>
                            <input type="date" id="daily-date" required>
                        </div>
                        <div class="form-group">
                            <label for="weight">ä½“é‡ (kg)</label>
                            <input type="number" id="weight" step="0.1" required>
                        </div>
                        <div class="form-group">
                            <label for="calories">æ‘‚å–ã‚«ãƒ­ãƒªãƒ¼ (kcal)</label>
                            <input type="number" id="calories" required>
                        </div>
                        <div class="form-group">
                            <label for="steps">æ­©æ•°</label>
                            <input type="number" id="steps" required>
                        </div>
                        <div class="form-group">
                            <label for="event">ã‚¤ãƒ™ãƒ³ãƒˆ</label>
                            <input type="text" id="event" placeholder="ä¾‹: ä¼šé£Ÿã€ä½“èª¿ä¸è‰¯ã€ãƒãƒ¼ãƒˆãƒ‡ã‚¤">
                        </div>
                    </div>
                    <button type="submit" class="btn">ãƒ‡ãƒ¼ã‚¿ä¿å­˜</button>
                    <button type="button" class="btn btn-secondary" onclick="clearDailyForm()">ã‚¯ãƒªã‚¢</button>
                </form>
            </div>

            <div class="form-section">
                <h3>ğŸ“ˆ æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿ä¸€è¦§</h3>
                <div class="table-container">
                    <table class="data-table" id="daily-table">
                        <thead>
                            <tr class="desktop-header">
                                <th>æ—¥ä»˜</th>
                                <th>ä½“é‡ (kg)</th>
                                <th>å‰æ—¥æ¯”</th>
                                <th>æ‘‚å–ã‚«ãƒ­ãƒªãƒ¼ (kcal)</th>
                                <th>æ­©æ•°</th>
                                <th>æ­©è¡Œæ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼</th>
                                <th>ç­‹ãƒˆãƒ¬æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼</th>
                                <th>ã‚¤ãƒ™ãƒ³ãƒˆ</th>
                                <th>æ“ä½œ</th>
                            </tr>
                            <tr class="mobile-header">
                                <th>ğŸ“…</th>
                                <th>âš–ï¸</th>
                                <th>ğŸ§®</th>
                                <th>ğŸš</th>
                                <th>ğŸš¶</th>
                                <th>ğŸš¶</th>
                                <th>ğŸ‹ï¸</th>
                                <th>ğŸ“</th>
                                <th>âŒ</th>
                            </tr>
                        </thead>
                        <tbody id="daily-table-body">
                            <!-- ãƒ‡ãƒ¼ã‚¿ãŒå‹•çš„ã«æŒ¿å…¥ã•ã‚Œã¾ã™ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ç­‹åŠ›ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ç®¡ç†ã‚¿ãƒ– -->
        <div id="training" class="tab-content">
            <div class="form-section">
                <h3>ğŸ‹ï¸ ç­‹åŠ›ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²</h3>
                <form id="training-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="training-date">å¹´æœˆæ—¥</label>
                            <input type="date" id="training-date" required>
                        </div>
                        <div class="form-group">
                            <label for="exercise">ç¨®ç›®</label>
                            <select id="exercise" required>
                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                <option value="ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹">ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹</option>
                                <option value="ãƒšãƒƒã‚¯ãƒ•ãƒ©ã‚¤">ãƒšãƒƒã‚¯ãƒ•ãƒ©ã‚¤</option>
                                <option value="ãƒ‡ã‚£ãƒƒãƒ—ã‚¹">ãƒ‡ã‚£ãƒƒãƒ—ã‚¹</option>
                                <option value="ãƒ‡ã‚¯ãƒ©ã‚¤ãƒ³ãƒ—ãƒ¬ã‚¹">ãƒ‡ã‚¯ãƒ©ã‚¤ãƒ³ãƒ—ãƒ¬ã‚¹</option>
                                <option value="ãƒ©ãƒƒãƒˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³">ãƒ©ãƒƒãƒˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³</option>
                                <option value="DYãƒ­ãƒ¼ã‚¤ãƒ³ã‚°">DYãƒ­ãƒ¼ã‚¤ãƒ³ã‚°</option>
                                <option value="Tãƒãƒ¼ãƒ­ãƒ¼ã‚¤ãƒ³ã‚°">Tãƒãƒ¼ãƒ­ãƒ¼ã‚¤ãƒ³ã‚°</option>
                                <option value="ãƒãƒ³ãƒ‹ãƒ³ã‚°">ãƒãƒ³ãƒ‹ãƒ³ã‚°</option>
                                <option value="ãƒã‚·ãƒ³ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹">ãƒã‚·ãƒ³ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹</option>
                                <option value="ãƒ€ãƒ³ãƒ™ãƒ«ã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚º">ãƒ€ãƒ³ãƒ™ãƒ«ã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚º</option>
                                <option value="ãƒ€ãƒ³ãƒ™ãƒ«ãƒªã‚¢ãƒ¬ã‚¤ã‚º">ãƒ€ãƒ³ãƒ™ãƒ«ãƒªã‚¢ãƒ¬ã‚¤ã‚º</option>
                                <option value="ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ãƒ³ãƒ€ãƒ³ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«">ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ãƒ³ãƒ€ãƒ³ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«</option>
                                <option value="ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ">ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ</option>
                                <option value="ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ">ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ</option>
                                <option value="ãƒãƒƒã‚¯ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ">ãƒãƒƒã‚¯ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ</option>
                                <option value="45åº¦ãƒ¬ãƒƒã‚°ãƒ—ãƒ¬ã‚¹">45åº¦ãƒ¬ãƒƒã‚°ãƒ—ãƒ¬ã‚¹</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="training-weight">é‡é‡ (kg)</label>
                            <input type="number" id="training-weight" step="0.5" required>
                        </div>
                        <div class="form-group">
                            <label for="reps">å›æ•°</label>
                            <select id="reps" required>
                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                                <option value="13">13</option>
                                <option value="14">14</option>
                                <option value="15">15</option>
                                <option value="16">16</option>
                                <option value="17">17</option>
                                <option value="18">18</option>
                                <option value="19">19</option>
                                <option value="20">20</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="sets">ã‚»ãƒƒãƒˆæ•°</label>
                            <select id="sets" required>
                                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                                <option value="13">13</option>
                                <option value="14">14</option>
                                <option value="15">15</option>
                                <option value="16">16</option>
                                <option value="17">17</option>
                                <option value="18">18</option>
                                <option value="19">19</option>
                                <option value="20">20</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn">ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²ä¿å­˜</button>
                    <button type="button" class="btn btn-secondary" onclick="clearTrainingForm()">ã‚¯ãƒªã‚¢</button>
                </form>
            </div>

            <div class="form-section">
                <h3>ğŸ“‹ ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²ä¸€è¦§</h3>
                <div class="table-container">
                    <table class="data-table" id="training-table">
                        <thead>
                            <tr class="desktop-header">
                                <th>æ—¥ä»˜</th>
                                <th>ç¨®ç›®</th>
                                <th>é‡é‡ (kg)</th>
                                <th>å›æ•°</th>
                                <th>ã‚»ãƒƒãƒˆæ•°</th>
                                <th>éƒ¨ä½</th>
                                <th>å¼·åº¦</th>
                                <th>æ“ä½œ</th>
                            </tr>
                            <tr class="mobile-header">
                                <th>ğŸ“…</th>
                                <th>ğŸ‹ï¸</th>
                                <th>âš–ï¸</th>
                                <th>ğŸ”¢</th>
                                <th>ğŸ”¢</th>
                                <th>ğŸ’ª</th>
                                <th>ğŸ”¥</th>
                                <th>âŒ</th>
                            </tr>
                        </thead>
                        <tbody id="training-table-body">
                            <!-- ãƒ‡ãƒ¼ã‚¿ãŒå‹•çš„ã«æŒ¿å…¥ã•ã‚Œã¾ã™ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ãƒ‡ãƒ¼ã‚¿åˆ†æãƒ»ã‚°ãƒ©ãƒ•ã‚¿ãƒ– -->
        <div id="analysis" class="tab-content">
            <div class="chart-container">
                <h3 id="chart-title">å¤§ä¼šå½“æ—¥ã¯è¨ˆç®—ä¸­...ã§ç€åœ°è¦‹è¾¼ã¿ï¼</h3>
                <div class="chart-wrapper">
                    <canvas id="analysisChart"></canvas>
                </div>
            </div>
        </div>

        <!-- ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¿ãƒ– -->
        <div id="export" class="tab-content">
            <div class="export-section">
                <h3>ğŸ“¤ ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</h3>
                <p>ãƒ‡ãƒ¼ã‚¿ã‚’CSVå½¢å¼ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¦ã€Excelã§é–‹ãã“ã¨ãŒã§ãã¾ã™ã€‚</p>
                <div style="margin-top: 20px;">
                    <button class="btn" onclick="exportDailyData()">æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                    <button class="btn" onclick="exportTrainingData()">ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                    <button class="btn" onclick="exportAllData()">å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Netlify Functions API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
        const API_BASE = '/.netlify/functions';

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let dailyData = [];
        let trainingData = [];
        let analysisChart = null;

        // æ—¥æœ¬ã®ç¥æ—¥ãƒ‡ãƒ¼ã‚¿ (2025å¹´)
        const holidays2025 = [
            '2025-01-01', '2025-01-13', '2025-02-11', '2025-02-23', '2025-03-20',
            '2025-04-29', '2025-05-03', '2025-05-04', '2025-05-05', '2025-07-21',
            '2025-08-11', '2025-09-15', '2025-09-23', '2025-10-13', '2025-11-03',
            '2025-11-23', '2025-12-23'
        ];

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
            setupDateDefaults();
            setupEventListeners();
        });

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
        function setupEventListeners() {
            document.getElementById('daily-form').addEventListener('submit', handleDailySubmit);
            document.getElementById('training-form').addEventListener('submit', handleTrainingSubmit);
        }

        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ—¥ä»˜ã®è¨­å®š
        function setupDateDefaults() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('daily-date').value = today;
            document.getElementById('training-date').value = today;
        }

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function showTab(tabName) {
            // ã™ã¹ã¦ã®ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éè¡¨ç¤º
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));

            // ã™ã¹ã¦ã®ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));

            // é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ã‚’è¡¨ç¤º
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // ã‚°ãƒ©ãƒ•ã‚¿ãƒ–ãŒé¸æŠã•ã‚ŒãŸå ´åˆã¯æç”»
            if (tabName === 'analysis') {
                setTimeout(() => drawAnalysisChart(), 100);
            }
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
        function showStatus(message, type = 'success') {
            const statusEl = document.getElementById('status-message');
            statusEl.innerHTML = `<div class="status-message status-${type}">${message}</div>`;
            setTimeout(() => {
                statusEl.innerHTML = '';
            }, 3000);
        }

        // å…¨ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        async function loadAllData() {
            try {
                showStatus('ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...', 'success');
                
                // æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
                const dailyResponse = await fetch(`${API_BASE}/get-daily-data`);
                if (dailyResponse.ok) {
                    dailyData = await dailyResponse.json();
                }

                // ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
                const trainingResponse = await fetch(`${API_BASE}/get-training-data`);
                if (trainingResponse.ok) {
                    trainingData = await trainingResponse.json();
                }

                updateDailyTable();
                updateTrainingTable();
                showStatus('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ãŒå®Œäº†ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                showStatus('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        // æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿é€ä¿¡å‡¦ç†
        async function handleDailySubmit(e) {
            e.preventDefault();
            
            const formData = {
                date: document.getElementById('daily-date').value,
                weight: parseFloat(document.getElementById('weight').value),
                calories: parseInt(document.getElementById('calories').value),
                steps: parseInt(document.getElementById('steps').value),
                event: document.getElementById('event').value
            };

            try {
                const response = await fetch(`${API_BASE}/save-daily-data`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    const result = await response.json();
                    showStatus('æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
                    loadAllData(); // ãƒ‡ãƒ¼ã‚¿ã‚’å†èª­ã¿è¾¼ã¿
                    clearDailyForm();
                } else {
                    throw new Error('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                console.error('ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
                showStatus('ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        // ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿é€ä¿¡å‡¦ç†
        async function handleTrainingSubmit(e) {
            e.preventDefault();
            
            const weight = parseFloat(document.getElementById('training-weight').value);
            const reps = parseInt(document.getElementById('reps').value);
            const sets = parseInt(document.getElementById('sets').value);
            const exercise = document.getElementById('exercise').value;
            
            // éƒ¨ä½ã®åˆ¤å®š
            const bodyPart = getBodyPart(exercise);
            
            // å¼·åº¦ã®è¨ˆç®—
            const intensity = calculateIntensity(weight, reps, sets);

            const formData = {
                date: document.getElementById('training-date').value,
                exercise: exercise,
                weight: weight,
                reps: reps,
                sets: sets,
                bodyPart: bodyPart,
                intensity: intensity
            };

            try {
                const response = await fetch(`${API_BASE}/save-training-data`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    const result = await response.json();
                    showStatus('ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
                    loadAllData(); // ãƒ‡ãƒ¼ã‚¿ã‚’å†èª­ã¿è¾¼ã¿
                    clearTrainingForm();
                } else {
                    throw new Error('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                console.error('ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
                showStatus('ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        // éƒ¨ä½åˆ¤å®šé–¢æ•°
        function getBodyPart(exercise) {
            const bodyPartMap = {
                'ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹': 'èƒ¸',
                'ãƒšãƒƒã‚¯ãƒ•ãƒ©ã‚¤': 'èƒ¸',
                'ãƒ‡ã‚£ãƒƒãƒ—ã‚¹': 'èƒ¸',
                'ãƒ‡ã‚¯ãƒ©ã‚¤ãƒ³ãƒ—ãƒ¬ã‚¹': 'èƒ¸',
                'ãƒ©ãƒƒãƒˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³': 'èƒŒä¸­',
                'DYãƒ­ãƒ¼ã‚¤ãƒ³ã‚°': 'èƒŒä¸­',
                'Tãƒãƒ¼ãƒ­ãƒ¼ã‚¤ãƒ³ã‚°': 'èƒŒä¸­',
                'ãƒãƒ³ãƒ‹ãƒ³ã‚°': 'èƒŒä¸­',
                'ãƒã‚·ãƒ³ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹': 'è‚©',
                'ãƒ€ãƒ³ãƒ™ãƒ«ã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚º': 'è‚©',
                'ãƒ€ãƒ³ãƒ™ãƒ«ãƒªã‚¢ãƒ¬ã‚¤ã‚º': 'è‚©',
                'ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ãƒ³ãƒ€ãƒ³ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«': 'è…•',
                'ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ': 'èƒŒä¸­',
                'ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ': 'è„š',
                'ãƒãƒƒã‚¯ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ': 'è„š',
                '45åº¦ãƒ¬ãƒƒã‚°ãƒ—ãƒ¬ã‚¹': 'è„š'
            };
            return bodyPartMap[exercise] || 'ãã®ä»–';
        }

        // å¼·åº¦è¨ˆç®—é–¢æ•°
        function calculateIntensity(weight, reps, sets) {
            // ç·é‡é‡ Ã— å›æ•° Ã— ã‚»ãƒƒãƒˆæ•°ã§å¼·åº¦ã‚’ç®—å‡º
            const totalVolume = weight * reps * sets;
            
            // å¼·åº¦ã‚’ã‚«ãƒ†ã‚´ãƒªåˆ†ã‘
            if (totalVolume >= 3000) return 'é«˜';
            if (totalVolume >= 1500) return 'ä¸­';
            return 'ä½';
        }

        // ãƒ•ã‚©ãƒ¼ãƒ ã‚¯ãƒªã‚¢
        function clearDailyForm() {
            document.getElementById('daily-form').reset();
            setupDateDefaults();
        }

        function clearTrainingForm() {
            document.getElementById('training-form').reset();
            setupDateDefaults();
        }

        // æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•°
        function formatDateWithDay(dateStr) {
            const date = new Date(dateStr + 'T00:00:00');
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const dayNames = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
            const dayOfWeek = dayNames[date.getDay()];
            
            let className = '';
            if (date.getDay() === 6) { // åœŸæ›œæ—¥
                className = 'saturday';
            } else if (date.getDay() === 0 || holidays2025.includes(dateStr)) { // æ—¥æ›œæ—¥ã¾ãŸã¯ç¥æ—¥
                className = 'sunday-holiday';
            }
            
            return {
                formatted: `${month}/${day}(${dayOfWeek})`,
                className: className
            };
        }

        // æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼è¨ˆç®— (175cm, 75kgç”·æ€§åŸºæº–)
        function calculateWalkingCalories(steps) {
            // 1æ­©ã‚ãŸã‚Šç´„0.04kcal (175cm, 75kgç”·æ€§)
            return Math.round(steps * 0.04);
        }

        function calculateTrainingCalories(date) {
            // ãã®æ—¥ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼ã‚’è¨ˆç®—
            const dayTraining = trainingData.filter(t => t.date === date);
            let totalCalories = 0;
            
            dayTraining.forEach(training => {
                const calories = calculateExerciseCalories(training.exercise, training.weight, training.reps, training.sets);
                totalCalories += calories;
            });
            
            return Math.round(totalCalories);
        }

        // ç­‹åŠ›ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ç¨®ç›®åˆ¥æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼è¨ˆç®—
        function calculateExerciseCalories(exercise, weight, reps, sets) {
            // ä½“é‡75kgã®ç”·æ€§ã‚’åŸºæº–ã¨ã—ãŸæ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼è¨ˆç®—
            const baseWeight = 75; // kg
            const exerciseMultipliers = {
                'ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹': 0.8,
                'ãƒšãƒƒã‚¯ãƒ•ãƒ©ã‚¤': 0.6,
                'ãƒ‡ã‚£ãƒƒãƒ—ã‚¹': 0.9,
                'ãƒ‡ã‚¯ãƒ©ã‚¤ãƒ³ãƒ—ãƒ¬ã‚¹': 0.7,
                'ãƒ©ãƒƒãƒˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³': 0.7,
                'DYãƒ­ãƒ¼ã‚¤ãƒ³ã‚°': 0.8,
                'Tãƒãƒ¼ãƒ­ãƒ¼ã‚¤ãƒ³ã‚°': 0.8,
                'ãƒãƒ³ãƒ‹ãƒ³ã‚°': 1.0,
                'ãƒã‚·ãƒ³ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹': 0.6,
                'ãƒ€ãƒ³ãƒ™ãƒ«ã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚º': 0.5,
                'ãƒ€ãƒ³ãƒ™ãƒ«ãƒªã‚¢ãƒ¬ã‚¤ã‚º': 0.5,
                'ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ãƒ³ãƒ€ãƒ³ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«': 0.4,
                'ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ': 1.2,
                'ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ': 1.1,
                'ãƒãƒƒã‚¯ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ': 1.0,
                '45åº¦ãƒ¬ãƒƒã‚°ãƒ—ãƒ¬ã‚¹': 0.9
            };

            const multiplier = exerciseMultipliers[exercise] || 0.6;
            
            // åŸºæœ¬æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼ = (é‡é‡ / ä½“é‡) Ã— ãƒ¬ãƒƒãƒ—æ•° Ã— ã‚»ãƒƒãƒˆæ•° Ã— ç¨®ç›®ä¿‚æ•° Ã— åŸºç¤ä»£è¬ä¿‚æ•°
            const baseCalories = (weight / baseWeight) * reps * sets * multiplier * 0.8;
            
            return Math.max(1, Math.round(baseCalories)); // æœ€ä½1kcal
        }

        // æœ€å°ä½“é‡è¨˜éŒ²ã®å–å¾—
        function getMinimumWeight(currentDate) {
            const sortedData = [...dailyData]
                .filter(item => item.date <= currentDate)
                .sort((a, b) => a.weight - b.weight);
            return sortedData.length > 0 ? sortedData[0].weight : null;
        }

        // ä½“é‡ãŒæœ€å°è¨˜éŒ²ã‹ã©ã†ã‹ã®åˆ¤å®š
        function isMinimumWeight(weight, date) {
            const minWeight = getMinimumWeight(date);
            return minWeight !== null && weight === minWeight;
        }

        // ç­‹ãƒˆãƒ¬å®Ÿæ–½æ—¥åˆ¤å®š
        function hasTrainingOnDate(date) {
            return trainingData.some(t => t.date === date);
        }

        // ç¯„å›²äºˆæ¸¬è¨ˆç®—é–¢æ•°
        function calculateWeightPrediction(weightData) {
            if (weightData.length < 2) {
                return {
                    minWeight: null,
                    maxWeight: null,
                    currentWeight: weightData.length > 0 ? weightData[weightData.length - 1].weight : null
                };
            }

            // 6/4ä»¥é™ã®ãƒ‡ãƒ¼ã‚¿ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆæ°´åˆ†ã‚’é™¤å¤–ï¼‰
            const startDate = '2025-06-04';
            const filteredData = weightData.filter(item => new Date(item.date) >= new Date(startDate));
            
            if (filteredData.length < 2) {
                return {
                    minWeight: null,
                    maxWeight: null,
                    currentWeight: weightData.length > 0 ? weightData[weightData.length - 1].weight : null
                };
            }

            const currentWeight = filteredData[filteredData.length - 1].weight;
            const latestDate = new Date(filteredData[filteredData.length - 1].date);
            const targetDate = new Date('2025-10-18');
            const daysToTarget = Math.ceil((targetDate - latestDate) / (1000 * 60 * 60 * 24));

            // ç¯„å›²äºˆæ¸¬ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
            const conservativeChange = -0.05; // kg/æ—¥ï¼ˆä¿å®ˆçš„ï¼‰
            const aggressiveChange = -0.12;   // kg/æ—¥ï¼ˆç©æ¥µçš„ï¼‰

            const minWeight = currentWeight + (aggressiveChange * daysToTarget);
            const maxWeight = currentWeight + (conservativeChange * daysToTarget);

            return {
                minWeight: Math.max(50, minWeight), // æœ€ä½50kg
                maxWeight: Math.min(100, maxWeight), // æœ€é«˜100kg
                currentWeight: currentWeight
            };
        }

        // æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°
        function updateDailyTable() {
            const tbody = document.getElementById('daily-table-body');
            tbody.innerHTML = '';

            // ãƒ‡ãƒ¼ã‚¿ã‚’ã‚½ãƒ¼ãƒˆ
            const sortedData = [...dailyData].sort((a, b) => new Date(b.date) - new Date(a.date));

            sortedData.forEach((item, index) => {
                const row = document.createElement('tr');
                
                // å‰æ—¥æ¯”è¨ˆç®—
                let weightDiff = '';
                let weightDiffClass = '';
                if (index < sortedData.length - 1) {
                    const prevWeight = sortedData[index + 1].weight;
                    const diff = item.weight - prevWeight;
                    if (diff > 0) {
                        weightDiff = `+${diff.toFixed(1)}`;
                        weightDiffClass = 'weight-increase';
                    } else if (diff < 0) {
                        weightDiff = diff.toFixed(1);
                        weightDiffClass = 'weight-decrease';
                    } else {
                        weightDiff = 'Â±0.0';
                    }
                }

                const dateInfo = formatDateWithDay(item.date);
                const walkingCalories = calculateWalkingCalories(item.steps);
                const trainingCalories = calculateTrainingCalories(item.date);
                
                // æœ€å°ä½“é‡è¨˜éŒ²ã®åˆ¤å®š
                const isMinWeight = isMinimumWeight(item.weight, item.date);
                const weightDisplay = isMinWeight ? `${item.weight} ğŸ‘‘` : item.weight;

                row.innerHTML = `
                    <td class="${dateInfo.className}">${dateInfo.formatted}</td>
                    <td>${weightDisplay}</td>
                    <td class="${weightDiffClass}">${weightDiff}</td>
                    <td>${item.calories}</td>
                    <td>${item.steps.toLocaleString()}</td>
                    <td>${walkingCalories}</td>
                    <td>${trainingCalories}</td>
                    <td>${item.event || '-'}</td>
                    <td>
                        <button class="btn" onclick="editDailyData('${item.date}')" style="padding: 4px 8px; font-size: 0.7rem; margin-right: 3px;">ç·¨é›†</button>
                        <button class="btn" onclick="deleteDailyData('${item.date}')" style="padding: 4px 8px; font-size: 0.7rem;">å‰Šé™¤</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°
        function updateTrainingTable() {
            const tbody = document.getElementById('training-table-body');
            tbody.innerHTML = '';

            // ãƒ‡ãƒ¼ã‚¿ã‚’ã‚½ãƒ¼ãƒˆ
            const sortedData = [...trainingData].sort((a, b) => new Date(b.date) - new Date(a.date));

            sortedData.forEach((item, index) => {
                const row = document.createElement('tr');
                const dateInfo = formatDateWithDay(item.date);

                row.innerHTML = `
                    <td class="${dateInfo.className}">${dateInfo.formatted}</td>
                    <td>${item.exercise}</td>
                    <td>${item.weight}</td>
                    <td>${item.reps}</td>
                    <td>${item.sets}</td>
                    <td>${item.bodyPart || getBodyPart(item.exercise)}</td>
                    <td>${item.intensity || calculateIntensity(item.weight, item.reps, item.sets)}</td>
                    <td>
                        <button class="btn" onclick="editTrainingData(${index})" style="padding: 4px 8px; font-size: 0.7rem; margin-right: 3px;">ç·¨é›†</button>
                        <button class="btn" onclick="deleteTrainingData(${index})" style="padding: 4px 8px; font-size: 0.7rem;">å‰Šé™¤</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿ç·¨é›†æ©Ÿèƒ½
        function editDailyData(date) {
            const item = dailyData.find(d => d.date === date);
            if (!item) return;

            // ãƒ•ã‚©ãƒ¼ãƒ ã«å€¤ã‚’è¨­å®š
            document.getElementById('daily-date').value = item.date;
            document.getElementById('weight').value = item.weight;
            document.getElementById('calories').value = item.calories;
            document.getElementById('steps').value = item.steps;
            document.getElementById('event').value = item.event || '';

            // æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚¿ãƒ–ã«ç§»å‹•
            showTab('daily');
            
            // ãƒ•ã‚©ãƒ¼ãƒ ã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            document.getElementById('daily-form').scrollIntoView({ behavior: 'smooth' });
            
            showStatus('ãƒ‡ãƒ¼ã‚¿ã‚’ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã§èª­ã¿è¾¼ã¿ã¾ã—ãŸã€‚ä¿®æ­£ã—ã¦ä¿å­˜ã—ã¦ãã ã•ã„ã€‚', 'success');
        }

        // ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ç·¨é›†æ©Ÿèƒ½
        function editTrainingData(index) {
            const item = trainingData[index];
            if (!item) return;

            // ãƒ•ã‚©ãƒ¼ãƒ ã«å€¤ã‚’è¨­å®š
            document.getElementById('training-date').value = item.date;
            document.getElementById('exercise').value = item.exercise;
            document.getElementById('training-weight').value = item.weight;
            document.getElementById('reps').value = item.reps;
            document.getElementById('sets').value = item.sets;

            // ç­‹åŠ›ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ç®¡ç†ã‚¿ãƒ–ã«ç§»å‹•
            showTab('training');
            
            // ãƒ•ã‚©ãƒ¼ãƒ ã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            document.getElementById('training-form').scrollIntoView({ behavior: 'smooth' });
            
            showStatus('ãƒ‡ãƒ¼ã‚¿ã‚’ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã§èª­ã¿è¾¼ã¿ã¾ã—ãŸã€‚ä¿®æ­£ã—ã¦ä¿å­˜ã—ã¦ãã ã•ã„ã€‚', 'success');
        }

        // ãƒ‡ãƒ¼ã‚¿å‰Šé™¤å‡¦ç†
        async function deleteDailyData(date) {
            if (!confirm('ã“ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;

            try {
                const response = await fetch(`${API_BASE}/delete-daily-data`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ date })
                });

                if (response.ok) {
                    showStatus('ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
                    loadAllData();
                } else {
                    throw new Error('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                console.error('å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
                showStatus('ãƒ‡ãƒ¼ã‚¿ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        async function deleteTrainingData(index) {
            if (!confirm('ã“ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;

            try {
                const response = await fetch(`${API_BASE}/delete-training-data`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ index })
                });

                if (response.ok) {
                    showStatus('ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
                    loadAllData();
                } else {
                    throw new Error('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                console.error('å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
                showStatus('ãƒ‡ãƒ¼ã‚¿ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        // åˆ†æã‚°ãƒ©ãƒ•æç”»
        function drawAnalysisChart() {
            const ctx = document.getElementById('analysisChart').getContext('2d');
            const isMobile = window.innerWidth <= 768;
            
            if (analysisChart) {
                analysisChart.destroy();
            }

            // ãƒ‡ãƒ¼ã‚¿æº–å‚™
            const startDate = new Date('2025-06-01');
            const endDate = new Date('2025-10-18');
            const dateRange = [];
            const currentDate = new Date(startDate);

            while (currentDate <= endDate) {
                dateRange.push(new Date(currentDate));
                currentDate.setDate(currentDate.getDate() + 1);
            }

            // å„ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã®æº–å‚™
            const labels = dateRange.map(date => {
                const month = date.getMonth() + 1;
                const day = date.getDate();
                return `${month}/${day}`;
            });

            const weightData = [];
            const totalCaloriesData = [];
            const eventData = [];

            dateRange.forEach(date => {
                const dateStr = date.toISOString().split('T')[0];
                const dailyRecord = dailyData.find(d => d.date === dateStr);
                
                if (dailyRecord) {
                    weightData.push(dailyRecord.weight);
                    const walkingCal = calculateWalkingCalories(dailyRecord.steps);
                    const trainingCal = calculateTrainingCalories(dateStr);
                    totalCaloriesData.push(walkingCal + trainingCal);
                    eventData.push(dailyRecord.event || '');
                } else {
                    weightData.push(null);
                    totalCaloriesData.push(null);
                    eventData.push('');
                }
            });

            // ç¯„å›²äºˆæ¸¬ã®è¨ˆç®—
            const weightPrediction = calculateWeightPrediction(dailyData);
            
            // äºˆæ¸¬ç·šãƒ‡ãƒ¼ã‚¿ï¼ˆä¸Šé™ã®ã¿è¡¨ç¤ºï¼‰
            let predictionData = new Array(labels.length).fill(null);
            
            if (weightPrediction.minWeight && weightPrediction.maxWeight) {
                const currentIndex = dateRange.findIndex(date => {
                    const dateStr = date.toISOString().split('T')[0];
                    return dailyData.some(d => d.date === dateStr);
                });
                
                if (currentIndex >= 0) {
                    const endIndex = labels.length - 1;
                    // ä¸€ç•ªé‡ã„é‡é‡ï¼ˆä¸Šé™ï¼‰ã®ã¿ã®äºˆæ¸¬ç·š
                    predictionData[currentIndex] = weightPrediction.currentWeight;
                    predictionData[endIndex] = weightPrediction.maxWeight;
                }
            }

            // ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å€¤ã¨ã—ã¦ä¸Šé™ã‚’è¡¨ç¤ºï¼‰
            const chartTitle = document.getElementById('chart-title');
            if (weightPrediction.minWeight && weightPrediction.maxWeight) {
                chartTitle.textContent = `å¤§ä¼šå½“æ—¥ã¯${weightPrediction.maxWeight.toFixed(1)}kgã€œ${weightPrediction.minWeight.toFixed(1)}kgã§ç€åœ°è¦‹è¾¼ã¿ï¼ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼š${weightPrediction.maxWeight.toFixed(1)}kgï¼‰`;
            } else {
                chartTitle.textContent = 'å¤§ä¼šå½“æ—¥ã¯è¨ˆç®—ä¸­...ã§ç€åœ°è¦‹è¾¼ã¿ï¼';
            }

            // è»¸ã®ç¯„å›²è¨ˆç®—ï¼ˆä½“é‡ã®ä¸‹é™ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å€¤ã«åˆã‚ã›ã‚‹ï¼‰
            const validWeights = weightData.filter(w => w !== null && !isNaN(w));
            let weightMin = validWeights.length > 0 ? Math.min(...validWeights) - 2 : 60;
            let weightMax = validWeights.length > 0 ? Math.max(...validWeights) + 2 : 80;
            
            // äºˆæ¸¬å€¤ã‚’è€ƒæ…®ã—ã¦Yè»¸ç¯„å›²ã‚’èª¿æ•´ï¼ˆæœ€ä¸‹é™ã¯ä¸€ç•ªé‡ã„ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é‡é‡ï¼‰
            if (weightPrediction.maxWeight) {
                weightMin = weightPrediction.maxWeight - 1; // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æœ€é‡é‡ã‚’ä¸‹é™ã«
                weightMax = Math.max(weightMax, weightPrediction.maxWeight + 1);
            }

            const validCalories = totalCaloriesData.filter(c => c !== null && !isNaN(c) && c > 0);
            const caloriesMin = validCalories.length > 0 ? Math.max(0, Math.min(...validCalories) - 100) : 0;
            const caloriesMax = validCalories.length > 0 ? Math.max(...validCalories) + 100 : 1000;

            // æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿ã®è‰²åˆ†ã‘ï¼ˆç­‹ãƒˆãƒ¬æ—¥ã¨ã‚¦ã‚©ãƒ¼ã‚­ãƒ³ã‚°ã®ã¿ã®æ—¥ï¼‰
            const backgroundColors = [];
            const borderColors = [];
            
            dateRange.forEach(date => {
                const dateStr = date.toISOString().split('T')[0];
                if (hasTrainingOnDate(dateStr)) {
                    backgroundColors.push('rgba(217, 51, 63, 0.6)'); // ç­‹ãƒˆãƒ¬æ—¥: #d9333f
                    borderColors.push('#d9333f');
                } else {
                    backgroundColors.push('rgba(16, 185, 129, 0.6)'); // ã‚¦ã‚©ãƒ¼ã‚­ãƒ³ã‚°ã®ã¿: å…ƒã®è‰²
                    borderColors.push('#10b981');
                }
            });

            try {
                const chartOptions = {
                    responsive: true,
                    maintainAspectRatio: !isMobile, // PCã§ã¯ç¸¦æ¨ªæ¯”å›ºå®šã€ã‚¹ãƒãƒ›ã§ã¯è‡ªç”±
                    aspectRatio: !isMobile ? 4/3 : undefined, // PCã®ã¿4:3æ¯”ç‡
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: {
                                    size: isMobile ? 14 : 12 // ã‚¹ãƒãƒ›ã§ã¯å‡¡ä¾‹æ–‡å­—ã‚’å¤§ãã
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                afterBody: function(context) {
                                    const dataIndex = context[0].dataIndex;
                                    const event = eventData[dataIndex];
                                    const dateStr = dateRange[dataIndex].toISOString().split('T')[0];
                                    
                                    let tooltipText = '';
                                    if (event && context[0].datasetIndex === 0) {
                                        tooltipText += `ã‚¤ãƒ™ãƒ³ãƒˆ: ${event}`;
                                    }
                                    if (context[0].datasetIndex === 1 && dataIndex === labels.length - 1) {
                                        tooltipText += '10æœˆ18æ—¥ã®äºˆæ¸¬ï¼ˆæœ€é‡é‡ï¼‰';
                                    }
                                    if (context[0].datasetIndex === 2) {
                                        const hasTraining = hasTrainingOnDate(dateStr);
                                        tooltipText += hasTraining ? 'ç­‹ãƒˆãƒ¬å®Ÿæ–½æ—¥' : 'ã‚¦ã‚©ãƒ¼ã‚­ãƒ³ã‚°ã®ã¿';
                                    }
                                    return tooltipText;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'æ—¥ä»˜',
                                font: {
                                    size: isMobile ? 14 : 12 // ã‚¹ãƒãƒ›ã§ã¯è»¸ã‚¿ã‚¤ãƒˆãƒ«ã‚’å¤§ãã
                                }
                            },
                            ticks: {
                                font: {
                                    size: isMobile ? 12 : 10 // ã‚¹ãƒãƒ›ã§ã¯è»¸ãƒ©ãƒ™ãƒ«ã‚’å¤§ãã
                                }
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'ä½“é‡ (kg)',
                                font: {
                                    size: isMobile ? 14 : 12 // ã‚¹ãƒãƒ›ã§ã¯è»¸ã‚¿ã‚¤ãƒˆãƒ«ã‚’å¤§ãã
                                }
                            },
                            ticks: {
                                font: {
                                    size: isMobile ? 12 : 10 // ã‚¹ãƒãƒ›ã§ã¯è»¸ãƒ©ãƒ™ãƒ«ã‚’å¤§ãã
                                }
                            },
                            min: weightMin,
                            max: weightMax
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼ (kcal)',
                                font: {
                                    size: isMobile ? 14 : 12 // ã‚¹ãƒãƒ›ã§ã¯è»¸ã‚¿ã‚¤ãƒˆãƒ«ã‚’å¤§ãã
                                }
                            },
                            ticks: {
                                font: {
                                    size: isMobile ? 12 : 10 // ã‚¹ãƒãƒ›ã§ã¯è»¸ãƒ©ãƒ™ãƒ«ã‚’å¤§ãã
                                }
                            },
                            grid: {
                                drawOnChartArea: false
                            },
                            min: caloriesMin,
                            max: caloriesMax
                        }
                    }
                };

                // ã‚¹ãƒãƒ›ã§ã®ã¿é«˜è§£åƒåº¦å¯¾å¿œã¨ã‚¹ã‚¿ã‚¤ãƒ«èª¿æ•´ã‚’è¿½åŠ 
                if (isMobile) {
                    chartOptions.devicePixelRatio = window.devicePixelRatio || 1;
                    chartOptions.elements = {
                        point: {
                            hoverRadius: 8 // ã‚¹ãƒãƒ›ã§ã®ãƒ›ãƒãƒ¼æ™‚ã®ç‚¹ã‚’å¤§ãã
                        },
                        line: {
                            borderJoinStyle: 'round', // ç·šã®æ¥ç¶šéƒ¨ã‚’ä¸¸ã
                            borderCapStyle: 'round'   // ç·šã®ç«¯ã‚’ä¸¸ã
                        }
                    };
                }

                analysisChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'ä½“é‡ (kg)',
                            data: weightData,
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderWidth: isMobile ? 4 : 3, // ã‚¹ãƒãƒ›ã§ã¯ç·šã‚’å¤ªã
                            yAxisID: 'y',
                            tension: 0.1,
                            pointBackgroundColor: '#ef4444',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: isMobile ? 3 : 2, // ã‚¹ãƒãƒ›ã§ã¯å¢ƒç•Œç·šã‚’å¤ªã
                            pointRadius: isMobile ? 6 : 5, // ã‚¹ãƒãƒ›ã§ã¯ç‚¹ã‚’å¤§ãã
                            spanGaps: true
                        }, {
                            label: 'äºˆæ¸¬ï¼ˆæœ€é‡é‡ï¼‰',
                            data: predictionData,
                            borderColor: '#ef4444',
                            backgroundColor: 'transparent',
                            borderWidth: isMobile ? 3 : 2, // ã‚¹ãƒãƒ›ã§ã¯ç·šã‚’å¤ªã
                            borderDash: [5, 5],
                            yAxisID: 'y',
                            tension: 0,
                            pointRadius: 0,
                            spanGaps: true
                        }, {
                            label: 'ç·æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼ (kcal)',
                            data: totalCaloriesData,
                            type: 'bar',
                            backgroundColor: backgroundColors,
                            borderColor: borderColors,
                            borderWidth: isMobile ? 2 : 1, // ã‚¹ãƒãƒ›ã§ã¯å¢ƒç•Œç·šã‚’å¤ªã
                            yAxisID: 'y1'
                        }]
                    },
                    options: chartOptions
                });
                
                // ã‚¹ãƒãƒ›ã§ã®ã¿é«˜è§£åƒåº¦å¯¾å¿œã®è¿½åŠ è¨­å®š
                if (isMobile) {
                    const canvas = analysisChart.canvas;
                    const rect = canvas.getBoundingClientRect();
                    const devicePixelRatio = window.devicePixelRatio || 1;
                    
                    canvas.width = rect.width * devicePixelRatio;
                    canvas.height = rect.height * devicePixelRatio;
                    canvas.style.width = rect.width + 'px';
                    canvas.style.height = rect.height + 'px';
                    
                    const ctx = canvas.getContext('2d');
                    ctx.scale(devicePixelRatio, devicePixelRatio);
                    
                    // ãƒãƒ£ãƒ¼ãƒˆã‚’å†æç”»
                    analysisChart.resize();
                }
            } catch (error) {
                console.error('ã‚°ãƒ©ãƒ•ã®æç”»ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
                const chartTitle = document.getElementById('chart-title');
                chartTitle.textContent = 'ã‚°ãƒ©ãƒ•ã®è¡¨ç¤ºã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';
                showStatus('ã‚°ãƒ©ãƒ•ã®è¡¨ç¤ºã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚', 'error');
            }
        }

        // CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½
        function exportDailyData() {
            const headers = ['æ—¥ä»˜', 'ä½“é‡(kg)', 'æ‘‚å–ã‚«ãƒ­ãƒªãƒ¼(kcal)', 'æ­©æ•°', 'æ­©è¡Œæ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼', 'ç­‹ãƒˆãƒ¬æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼', 'ã‚¤ãƒ™ãƒ³ãƒˆ'];
            
            const csvContent = [
                headers.join(','),
                ...dailyData.map(item => [
                    item.date,
                    item.weight,
                    item.calories,
                    item.steps,
                    calculateWalkingCalories(item.steps),
                    calculateTrainingCalories(item.date),
                    `"${item.event || ''}"`
                ].join(','))
            ].join('\n');

            downloadCSV(csvContent, 'daily_data.csv');
        }

        function exportTrainingData() {
            const headers = ['æ—¥ä»˜', 'ç¨®ç›®', 'é‡é‡(kg)', 'å›æ•°', 'ã‚»ãƒƒãƒˆæ•°', 'éƒ¨ä½', 'å¼·åº¦'];
            
            const csvContent = [
                headers.join(','),
                ...trainingData.map(item => [
                    item.date,
                    `"${item.exercise}"`,
                    item.weight,
                    item.reps,
                    item.sets,
                    item.bodyPart || getBodyPart(item.exercise),
                    item.intensity || calculateIntensity(item.weight, item.reps, item.sets)
                ].join(','))
            ].join('\n');

            downloadCSV(csvContent, 'training_data.csv');
        }

        function exportAllData() {
            // æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿ã¨ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’çµ±åˆ
            const headers = ['æ—¥ä»˜', 'ä½“é‡(kg)', 'æ‘‚å–ã‚«ãƒ­ãƒªãƒ¼(kcal)', 'æ­©æ•°', 'æ­©è¡Œæ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼', 'ç­‹ãƒˆãƒ¬æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼', 'ã‚¤ãƒ™ãƒ³ãƒˆ', 'ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è©³ç´°'];
            
            const csvContent = [
                headers.join(','),
                ...dailyData.map(item => {
                    const dayTraining = trainingData.filter(t => t.date === item.date);
                    const trainingDetails = dayTraining.map(t => 
                        `${t.exercise}:${t.weight}kgÃ—${t.reps}å›Ã—${t.sets}ã‚»ãƒƒãƒˆ`
                    ).join(';');
                    
                    return [
                        item.date,
                        item.weight,
                        item.calories,
                        item.steps,
                        calculateWalkingCalories(item.steps),
                        calculateTrainingCalories(item.date),
                        `"${item.event || ''}"`,
                        `"${trainingDetails}"`
                    ].join(',');
                })
            ].join('\n');

            downloadCSV(csvContent, 'all_data.csv');
        }

        function downloadCSV(content, filename) {
            const BOM = '\uFEFF'; // UTF-8 BOM for Excel compatibility
            const blob = new Blob([BOM + content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showStatus(`${filename} ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ`);
        }
    </script>
</body>
</html>
